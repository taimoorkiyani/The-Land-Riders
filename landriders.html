<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE LAND RIDERS | Muzaffarabad Ride Service</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --primary: #2E7D32;
            --secondary: #FFD600;
            --accent: #1B5E20;
            --light: #FFFFFF;
            --dark: #212121;
            --gray: #757575;
            --light-gray: #F5F5F5;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #F44336;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--light);
            color: var(--dark);
            overflow-x: hidden;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }

        .loading-logo {
            font-size: 48px;
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: var(--secondary);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Main Container */
        .container {
            display: none;
            min-height: 100vh;
            background: var(--light-gray);
        }

        /* Header */
        .header {
            background: var(--light);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary);
            font-size: 24px;
            font-weight: 700;
            text-decoration: none;
        }

        .logo-icon {
            color: var(--secondary);
            display: flex;
            align-items: center;
        }

        /* Login Container */
        .login-container {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        }

        .login-box {
            background: var(--light);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h2 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .login-tabs {
            display: flex;
            background: var(--light-gray);
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 30px;
        }

        .login-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .login-tab.active {
            background: var(--light);
            color: var(--primary);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--light);
        }

        .btn-primary:hover {
            background: var(--accent);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--secondary);
            color: var(--dark);
        }

        .btn-secondary:hover {
            background: #FFC107;
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: var(--light);
        }

        .btn-danger {
            background: var(--danger);
            color: var(--light);
        }

        .btn-warning {
            background: var(--warning);
            color: var(--light);
        }

        .btn-whatsapp {
            background: #25D366;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-whatsapp:hover {
            background: #128C7E;
            transform: translateY(-2px);
        }

        .whatsapp-section {
            background: rgba(37, 211, 102, 0.1);
            border: 2px solid #25D366;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
        }

        .whatsapp-section p {
            margin: 10px 0;
            color: var(--dark);
        }

        /* Customer Dashboard */
        .customer-dashboard {
            display: none;
        }

        .main-content {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            display: flex;
            gap: 20px;
        }

        .booking-panel {
            width: 350px;
            background: var(--light);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .map-container {
            flex: 1;
            background: var(--light);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        #map {
            width: 100%;
            height: 600px;
        }

        .location-inputs {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            padding: 20px;
            border-radius: 10px;
            color: white;
            margin-bottom: 20px;
        }

        .location-input {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .location-input:last-child {
            margin-bottom: 0;
        }

        .location-input i {
            color: var(--secondary);
        }

        .location-input input {
            flex: 1;
            padding: 10px;
            border: none;
            background: rgba(255,255,255,0.2);
            border-radius: 5px;
            color: white;
            font-size: 16px;
        }

        .location-input input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .vehicle-options {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .vehicle-option {
            flex: 1;
            text-align: center;
            padding: 15px;
            border: 2px solid var(--light-gray);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .vehicle-option.active {
            border-color: var(--primary);
            background: rgba(46, 125, 50, 0.1);
        }

        .vehicle-option i {
            font-size: 24px;
            color: var(--primary);
            margin-bottom: 10px;
        }

        /* Rider Dashboard */
        .rider-dashboard {
            display: none;
        }

        .rider-controls {
            width: 350px;
            background: var(--light);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .status-card {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .status-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.3);
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--secondary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }

        .live-location {
            background: var(--light);
            border: 2px solid var(--light-gray);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        /* Admin Dashboard */
        .admin-dashboard {
            display: none;
        }

        .admin-content {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--light);
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .stat-label {
            color: var(--gray);
            font-size: 16px;
        }

        /* Ride Offers */
        .offers-container {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .offer-card {
            background: var(--light);
            border: 2px solid var(--light-gray);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .offer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .offer-price {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }

        .offer-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        /* Notifications */
        .notification-badge {
            position: relative;
            cursor: pointer;
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--light);
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 20px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .booking-panel, .rider-controls {
                width: 100%;
            }
            
            .map-container {
                height: 400px;
            }
            
            #map, #riderMap {
                height: 400px;
            }
        }

        .error-message {
            color: var(--danger);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .success-message {
            color: var(--success);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .logo-image {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }

        /* Ride Request Cards */
        .ride-request-card {
            background: var(--light);
            border: 2px solid var(--light-gray);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .ride-request-card:hover {
            border-color: var(--primary);
            box-shadow: 0 5px 15px rgba(46, 125, 50, 0.1);
        }

        .ride-request-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .ride-request-info {
            margin-bottom: 10px;
        }

        .ride-request-info p {
            margin: 5px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ride-request-actions {
            display: flex;
            gap: 10px;
        }

        /* Dashboard Cards */
        .dashboard-card {
            background: var(--light);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .dashboard-card h3 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-gray);
        }

        /* Progress Bar */
        .progress-bar {
            height: 10px;
            background: var(--light-gray);
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 5px;
            transition: width 0.3s ease;
        }

        /* Chat Bubbles */
        .chat-bubble {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 15px;
            margin: 5px 0;
        }

        .chat-bubble.customer {
            background: var(--primary);
            color: white;
            margin-left: auto;
        }

        .chat-bubble.rider {
            background: var(--light-gray);
            color: var(--dark);
            margin-right: auto;
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-online {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success);
        }

        .status-offline {
            background: rgba(117, 117, 117, 0.1);
            color: var(--gray);
        }

        .status-pending {
            background: rgba(255, 152, 0, 0.1);
            color: var(--warning);
        }

        .status-completed {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success);
        }

        .status-cancelled {
            background: rgba(244, 67, 54, 0.1);
            color: var(--danger);
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            background: var(--light-gray);
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 10px;
            border: none;
            background: transparent;
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: var(--light);
            color: var(--primary);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* Advanced Features */
        .advanced-features {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid var(--light-gray);
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .feature-card {
            background: var(--light);
            border: 2px solid var(--light-gray);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
        }

        .feature-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .feature-card i {
            font-size: 24px;
            color: var(--primary);
            margin-bottom: 10px;
        }

        /* Rating Stars */
        .rating-stars {
            display: flex;
            gap: 2px;
            align-items: center;
        }

        .rating-stars i {
            color: #FFD600;
        }

        .rating-value {
            margin-left: 5px;
            font-weight: bold;
            color: var(--dark);
        }

        /* Search Box */
        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 15px 12px 45px;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            font-size: 16px;
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        /* Filter Options */
        .filter-options {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            background: var(--light-gray);
            border: 2px solid var(--light-gray);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">
            <i class="fas fa-motorcycle"></i>
            <span>THE LAND RIDERS</span>
        </div>
        <div class="loading-spinner"></div>
        <p style="color: white; margin-top: 20px;">Loading Muzaffarabad Ride Service...</p>
    </div>

    <!-- Login Container -->
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <div class="login-header">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-motorcycle" style="color: #FFD600;"></i>
                    </div>
                    <span style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-weight: bold; color: #2E7D32;">THE LAND RIDERS</span>
                    </span>
                </div>
                <p>Muzaffarabad's Premium Ride Service</p>
            </div>

            <div class="login-tabs">
                <button class="login-tab active" data-tab="customer">Customer</button>
                <button class="login-tab" data-tab="rider">Rider</button>
                <button class="login-tab" data-tab="admin">Admin</button>
            </div>

            <!-- Customer Login -->
            <div id="customerLoginForm" class="login-form active">
                <div class="form-group">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" class="form-input" id="customerPhone" placeholder="0301-1234567">
                    <div class="error-message" id="customerPhoneError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="customerPassword" placeholder="Enter password">
                    <div class="error-message" id="customerPasswordError"></div>
                </div>
                <button class="btn btn-primary" id="customerLoginBtn">Login as Customer</button>
                <button class="btn btn-secondary" id="customerRegisterBtn">Register New Customer</button>
            </div>

            <!-- Customer Registration -->
            <div id="customerRegisterForm" class="login-form" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" class="form-input" id="regPhone" placeholder="0301-1234567">
                    <div class="error-message" id="regPhoneError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-input" id="regName" placeholder="Enter your full name">
                    <div class="error-message" id="regNameError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Email (Optional)</label>
                    <input type="email" class="form-input" id="regEmail" placeholder="Enter your email">
                    <div class="error-message" id="regEmailError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="regPassword" placeholder="Create password (min 6 characters)">
                    <div class="error-message" id="regPasswordError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Confirm Password</label>
                    <input type="password" class="form-input" id="regConfirmPassword" placeholder="Confirm password">
                    <div class="error-message" id="regConfirmPasswordError"></div>
                </div>
                <button class="btn btn-primary" id="registerBtn">Register</button>
                <button class="btn btn-secondary" id="backToLoginBtn">Back to Login</button>
            </div>

            <!-- Rider Login -->
            <div id="riderLoginForm" class="login-form" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Rider ID</label>
                    <input type="text" class="form-input" id="riderId" placeholder="Enter 5-digit ID">
                    <div class="error-message" id="riderIdError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="riderPassword" placeholder="Enter password">
                    <div class="error-message" id="riderPasswordError"></div>
                </div>
                <button class="btn btn-primary" id="riderLoginBtn">Login as Rider</button>
                
                <div class="whatsapp-section">
                    <p><strong>New Rider?</strong></p>
                    <p>Contact us on WhatsApp to become a verified rider:</p>
                    <button class="btn btn-whatsapp" id="whatsappBtn">
                        <i class="fab fa-whatsapp"></i> Contact on WhatsApp
                    </button>
                    <p style="margin-top: 10px; font-size: 14px;">
                        <i class="fas fa-phone"></i> Or call: 0301-3036146
                    </p>
                    <p style="font-size: 12px; margin-top: 10px;">
                        After admin confirmation, you'll receive your login details
                    </p>
                </div>
            </div>

            <!-- Admin Login -->
            <div id="adminLoginForm" class="login-form" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Admin Name</label>
                    <input type="text" class="form-input" id="adminName" placeholder="Enter admin name">
                    <div class="error-message" id="adminNameError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="adminPassword" placeholder="Enter password">
                    <div class="error-message" id="adminPasswordError"></div>
                </div>
                <button class="btn btn-primary" id="adminLoginBtn">Login as Admin</button>
            </div>
        </div>
    </div>

    <!-- Customer Dashboard -->
    <div class="container customer-dashboard" id="customerDashboard">
        <header class="header">
            <div class="header-content">
                <a href="#" class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-motorcycle" style="color: #FFD600;"></i>
                    </div>
                    <span style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-weight: bold; color: #2E7D32;">THE LAND RIDERS</span>
                    </span>
                </a>
                <div style="display: flex; align-items: center; gap: 20px;">
                    <div class="notification-badge" id="notificationBtn">
                        <i class="fas fa-bell"></i>
                        <span class="badge" id="notificationCount">0</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;" id="customerAvatar">C</div>
                        <div>
                            <div style="font-weight: 600;" id="customerName">Customer</div>
                            <div style="font-size: 12px; color: var(--gray);">Muzaffarabad</div>
                        </div>
                    </div>
                    <button class="btn btn-secondary" id="logoutBtn" style="width: auto; padding: 8px 16px;">
                        Logout
                    </button>
                </div>
            </div>
        </header>

        <div class="main-content">
            <div class="booking-panel">
                <div class="location-inputs">
                    <h3 style="margin-bottom: 15px; color: white;">
                        <i class="fas fa-map-marker-alt"></i> Book Your Ride
                    </h3>
                    <div class="location-input">
                        <i class="fas fa-circle"></i>
                        <input type="text" id="pickupLocation" placeholder="Enter pickup location">
                    </div>
                    <div class="location-input">
                        <i class="fas fa-flag-checkered"></i>
                        <input type="text" id="destinationLocation" placeholder="Enter destination">
                    </div>
                    <button class="btn btn-secondary" id="findRidesBtn" style="margin-top: 15px;">
                        <i class="fas fa-search"></i> Find Available Rides
                    </button>
                </div>

                <div style="margin: 20px 0;">
                    <h4 style="margin-bottom: 10px; color: var(--primary);">Select Vehicle Type</h4>
                    <div class="vehicle-options">
                        <div class="vehicle-option active" data-type="bike">
                            <i class="fas fa-motorcycle"></i>
                            <div>Bike</div>
                            <div style="font-size: 12px; color: var(--gray);">Starting at Rs. 50</div>
                        </div>
                        <div class="vehicle-option" data-type="car">
                            <i class="fas fa-car"></i>
                            <div>Car</div>
                            <div style="font-size: 12px; color: var(--gray);">Starting at Rs. 200</div>
                        </div>
                    </div>
                </div>

                <div id="rideOffersSection" style="display: none;">
                    <h4 style="margin-bottom: 10px; color: var(--primary);">Ride Offers</h4>
                    <div class="offers-container" id="rideOffers"></div>
                </div>

                <div id="activeRideSection" style="display: none; margin-top: 20px;">
                    <h4 style="margin-bottom: 10px; color: var(--primary);">Active Ride</h4>
                    <div class="dashboard-card">
                        <div style="margin-bottom: 10px;">
                            <strong>Rider:</strong> <span id="activeRiderName">-</span>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>From:</strong> <span id="activePickupLocation">-</span>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>To:</strong> <span id="activeDestinationLocation">-</span>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>Fare:</strong> <span style="color: var(--primary); font-weight: bold;" id="activeRideFare">Rs. 0</span>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>Rider Phone:</strong> <span id="activeRiderPhone">-</span>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-danger" id="cancelRideBtn" style="flex: 1;">
                                <i class="fas fa-times"></i> Cancel Ride
                            </button>
                            <button class="btn btn-success" id="contactRiderBtn" style="flex: 1;">
                                <i class="fas fa-phone"></i> Call Rider
                            </button>
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary" id="complaintBtn" style="margin-top: 20px;">
                    <i class="fas fa-exclamation-triangle"></i> Submit Complaint
                </button>

                <div class="advanced-features">
                    <h4 style="margin-bottom: 10px; color: var(--primary);">My Stats</h4>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <i class="fas fa-car"></i>
                            <div style="font-size: 24px; font-weight: bold;" id="customerTotalRides">0</div>
                            <div style="font-size: 12px;">Total Rides</div>
                        </div>
                        <div class="feature-card">
                            <i class="fas fa-star"></i>
                            <div class="rating-stars">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <span class="rating-value" id="customerRating">5.0</span>
                            </div>
                            <div style="font-size: 12px;">My Rating</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="map-container">
                <div id="map"></div>
            </div>
        </div>
    </div>

    <!-- Rider Dashboard -->
    <div class="container rider-dashboard" id="riderDashboard">
        <header class="header">
            <div class="header-content">
                <a href="#" class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-motorcycle" style="color: #FFD600;"></i>
                    </div>
                    <span style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-weight: bold; color: #2E7D32;">THE LAND RIDERS</span>
                    </span>
                </a>
                <div style="display: flex; align-items: center; gap: 20px;">
                    <div class="notification-badge" id="riderNotificationBtn">
                        <i class="fas fa-bell"></i>
                        <span class="badge" id="riderNotificationCount">0</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;" id="riderAvatar">R</div>
                        <div>
                            <div style="font-weight: 600;" id="riderName">Rider</div>
                            <div style="font-size: 12px; color: var(--gray);">ID: <span id="riderIdDisplay">00000</span></div>
                        </div>
                    </div>
                    <button class="btn btn-secondary" id="riderLogoutBtn" style="width: auto; padding: 8px 16px;">
                        Logout
                    </button>
                </div>
            </div>
        </header>

        <div class="main-content">
            <div class="rider-controls">
                <div class="status-card">
                    <div class="status-toggle">
                        <div>
                            <h4 style="color: white;">Online Status</h4>
                            <p style="color: rgba(255,255,255,0.8); font-size: 14px;">Go online to receive rides</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="onlineToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div style="display: flex; justify-content: space-between; text-align: center;">
                        <div>
                            <div style="font-size: 24px; font-weight: bold;" id="todayRides">0</div>
                            <div style="font-size: 12px;">Today's Rides</div>
                        </div>
                        <div>
                            <div class="rating-stars">
                                <i class="fas fa-star"></i>
                                <span class="rating-value" id="riderRating">5.0</span>
                            </div>
                            <div style="font-size: 12px;">Rating</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: bold;" id="todayEarnings">Rs. 0</div>
                            <div style="font-size: 12px;">Earnings</div>
                        </div>
                    </div>
                </div>

                <div class="tab-navigation" id="riderTabs">
                    <button class="tab-btn active" data-tab="requests">Ride Requests</button>
                    <button class="tab-btn" data-tab="history">History</button>
                </div>

                <div id="requestsTab" class="tab-content active">
                    <div id="rideRequestsList"></div>
                </div>

                <div id="historyTab" class="tab-content" style="display: none;">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="riderHistorySearch" placeholder="Search rides...">
                    </div>
                    <div id="riderHistoryList"></div>
                </div>

                <div id="activeRideSectionRider" style="display: none; margin-top: 20px;">
                    <h4 style="margin-bottom: 15px; color: var(--primary);">Active Ride</h4>
                    <div class="dashboard-card">
                        <div style="margin-bottom: 10px;">
                            <strong>Customer:</strong> <span id="activeCustomerName">-</span>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>Customer Phone:</strong> <span id="activeCustomerPhone">-</span>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>From:</strong> <span id="activePickup">-</span>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>To:</strong> <span id="activeDestination">-</span>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>Fare:</strong> <span style="color: var(--primary); font-weight: bold;" id="activeFare">Rs. 0</span>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-success" id="arrivedBtn" style="flex: 1;">
                                <i class="fas fa-check"></i> Arrived
                            </button>
                            <button class="btn btn-primary" id="completeRideBtn" style="flex: 1;">
                                <i class="fas fa-flag-checkered"></i> Complete
                            </button>
                        </div>
                    </div>
                </div>

                <div class="advanced-features">
                    <h4 style="margin-bottom: 10px; color: var(--primary);">Advanced Features</h4>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <i class="fas fa-chart-line"></i>
                            <div>Performance</div>
                        </div>
                        <div class="feature-card">
                            <i class="fas fa-money-bill-wave"></i>
                            <div>Earnings</div>
                        </div>
                        <div class="feature-card">
                            <i class="fas fa-award"></i>
                            <div>Badges</div>
                        </div>
                        <div class="feature-card">
                            <i class="fas fa-cog"></i>
                            <div>Settings</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="map-container">
                <div id="riderMap"></div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div class="container admin-dashboard" id="adminDashboard">
        <header class="header">
            <div class="header-content">
                <a href="#" class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-motorcycle" style="color: #FFD600;"></i>
                    </div>
                    <span style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-weight: bold; color: #2E7D32;">THE LAND RIDERS - ADMIN</span>
                    </span>
                </a>
                <div style="display: flex; align-items: center; gap: 20px;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--accent); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">A</div>
                        <div>
                            <div style="font-weight: 600;" id="adminNameDisplay">Admin</div>
                            <div style="font-size: 12px; color: var(--gray);">Administrator</div>
                        </div>
                    </div>
                    <button class="btn btn-secondary" id="adminLogoutBtn" style="width: auto; padding: 8px 16px;">
                        Logout
                    </button>
                </div>
            </div>
        </header>

        <div class="admin-content">
            <div class="tab-navigation" id="adminTabs">
                <button class="tab-btn active" data-tab="overview">Overview</button>
                <button class="tab-btn" data-tab="riders">Riders</button>
                <button class="tab-btn" data-tab="customers">Customers</button>
                <button class="tab-btn" data-tab="rides">Rides</button>
                <button class="tab-btn" data-tab="complaints">Complaints</button>
                <button class="tab-btn" data-tab="settings">Settings</button>
            </div>

            <div id="overviewTab" class="tab-content active">
                <div class="admin-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="totalRides">0</div>
                        <div class="stat-label">Total Rides Today</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="activeRiders">0</div>
                        <div class="stat-label">Active Riders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalCustomers">0</div>
                        <div class="stat-label">Total Customers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalRevenue">Rs. 0</div>
                        <div class="stat-label">Today's Revenue</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="pendingComplaints">0</div>
                        <div class="stat-label">Pending Complaints</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalEarnings">Rs. 0</div>
                        <div class="stat-label">Total Earnings</div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <h3>Recent Activity</h3>
                    <div id="recentActivity"></div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <div class="dashboard-card">
                        <h3>Top Riders</h3>
                        <div id="topRiders"></div>
                    </div>
                    <div class="dashboard-card">
                        <h3>Top Customers</h3>
                        <div id="topCustomers"></div>
                    </div>
                </div>
            </div>

            <div id="ridersTab" class="tab-content" style="display: none;">
                <div style="display: flex; gap: 20px; margin-bottom: 30px;">
                    <button class="btn btn-primary" id="addRiderBtn">
                        <i class="fas fa-user-plus"></i> Add New Rider
                    </button>
                    <button class="btn btn-success" id="exportRidersBtn">
                        <i class="fas fa-download"></i> Export Data
                    </button>
                    <div class="search-box" style="flex: 1;">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchRiders" placeholder="Search riders...">
                    </div>
                </div>

                <div class="dashboard-card">
                    <h3>All Riders</h3>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: var(--light-gray);">
                                    <th style="padding: 12px; text-align: left;">Rider ID</th>
                                    <th style="padding: 12px; text-align: left;">Name</th>
                                    <th style="padding: 12px; text-align: left;">Phone</th>
                                    <th style="padding: 12px; text-align: left;">Rating</th>
                                    <th style="padding: 12px; text-align: left;">Total Rides</th>
                                    <th style="padding: 12px; text-align: left;">Earnings</th>
                                    <th style="padding: 12px; text-align: left;">Status</th>
                                    <th style="padding: 12px; text-align: left;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="ridersTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="customersTab" class="tab-content" style="display: none;">
                <div style="display: flex; gap: 20px; margin-bottom: 30px;">
                    <div class="search-box" style="flex: 1;">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchCustomers" placeholder="Search customers...">
                    </div>
                </div>

                <div class="dashboard-card">
                    <h3>All Customers</h3>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: var(--light-gray);">
                                    <th style="padding: 12px; text-align: left;">ID</th>
                                    <th style="padding: 12px; text-align: left;">Name</th>
                                    <th style="padding: 12px; text-align: left;">Phone</th>
                                    <th style="padding: 12px; text-align: left;">Email</th>
                                    <th style="padding: 12px; text-align: left;">Total Rides</th>
                                    <th style="padding: 12px; text-align: left;">Rating</th>
                                    <th style="padding: 12px; text-align: left;">Joined</th>
                                    <th style="padding: 12px; text-align: left;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="customersTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="ridesTab" class="tab-content" style="display: none;">
                <div style="display: flex; gap: 20px; margin-bottom: 30px;">
                    <button class="btn btn-primary" id="filterTodayBtn" class="filter-btn active">Today</button>
                    <button class="btn btn-secondary" id="filterWeekBtn" class="filter-btn">This Week</button>
                    <button class="btn btn-secondary" id="filterMonthBtn" class="filter-btn">This Month</button>
                    <button class="btn btn-secondary" id="filterAllBtn" class="filter-btn">All Time</button>
                    <div class="search-box" style="flex: 1;">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchRides" placeholder="Search rides...">
                    </div>
                </div>

                <div class="dashboard-card">
                    <h3>All Rides</h3>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: var(--light-gray);">
                                    <th style="padding: 12px; text-align: left;">Ride ID</th>
                                    <th style="padding: 12px; text-align: left;">Customer</th>
                                    <th style="padding: 12px; text-align: left;">Rider</th>
                                    <th style="padding: 12px; text-align: left;">Route</th>
                                    <th style="padding: 12px; text-align: left;">Fare</th>
                                    <th style="padding: 12px; text-align: left;">Date</th>
                                    <th style="padding: 12px; text-align: left;">Status</th>
                                    <th style="padding: 12px; text-align: left;">Rating</th>
                                    <th style="padding: 12px; text-align: left;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="ridesTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="complaintsTab" class="tab-content" style="display: none;">
                <div style="display: flex; gap: 20px; margin-bottom: 30px;">
                    <button class="btn btn-primary" id="viewComplaintsBtn">
                        <i class="fas fa-exclamation-circle"></i> View All Complaints
                    </button>
                    <div class="search-box" style="flex: 1;">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchComplaints" placeholder="Search complaints...">
                    </div>
                </div>

                <div class="dashboard-card">
                    <h3>Complaints Summary</h3>
                    <div id="complaintsSummary"></div>
                </div>

                <div class="dashboard-card">
                    <h3>Recent Complaints</h3>
                    <div id="recentComplaints"></div>
                </div>
            </div>

            <div id="settingsTab" class="tab-content" style="display: none;">
                <div class="dashboard-card">
                    <h3>System Settings</h3>
                    <div class="form-group">
                        <label class="form-label">Base Fare (Bike)</label>
                        <input type="number" class="form-input" id="baseFareBike" placeholder="Enter base fare for bike">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Base Fare (Car)</label>
                        <input type="number" class="form-input" id="baseFareCar" placeholder="Enter base fare for car">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Per Kilometer Rate (Bike)</label>
                        <input type="number" class="form-input" id="perKmBike" placeholder="Enter per km rate">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Per Kilometer Rate (Car)</label>
                        <input type="number" class="form-input" id="perKmCar" placeholder="Enter per km rate">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Minimum Fare</label>
                        <input type="number" class="form-input" id="minFare" placeholder="Enter minimum fare">
                    </div>
                    <button class="btn btn-primary" id="saveSettingsBtn">Save Settings</button>
                </div>

                <div class="dashboard-card">
                    <h3>Add New Admin</h3>
                    <button class="btn btn-secondary" id="addAdminBtn">
                        <i class="fas fa-user-shield"></i> Add New Admin
                    </button>
                </div>

                <div class="dashboard-card">
                    <h3>System Information</h3>
                    <div id="systemInfo"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Complaint Modal -->
    <div class="modal" id="complaintModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Submit Complaint</h3>
                <button class="btn" id="closeComplaintModal" style="width: auto; background: none; color: var(--gray);">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Rider Name</label>
                    <input type="text" class="form-input" id="complaintRiderName" placeholder="Enter rider name">
                    <div class="error-message" id="complaintRiderNameError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Rider ID (Optional)</label>
                    <input type="text" class="form-input" id="complaintRiderId" placeholder="Enter rider ID if known">
                </div>
                <div class="form-group">
                    <label class="form-label">Complaint Details</label>
                    <textarea class="form-input" id="complaintDetails" rows="4" placeholder="Describe the issue..."></textarea>
                    <div class="error-message" id="complaintDetailsError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Rate the Rider (1-5 stars)</label>
                    <div style="display: flex; gap: 5px; margin-top: 10px;">
                        <i class="fas fa-star rating-star" data-value="1" style="color: #ddd; cursor: pointer; font-size: 24px;"></i>
                        <i class="fas fa-star rating-star" data-value="2" style="color: #ddd; cursor: pointer; font-size: 24px;"></i>
                        <i class="fas fa-star rating-star" data-value="3" style="color: #ddd; cursor: pointer; font-size: 24px;"></i>
                        <i class="fas fa-star rating-star" data-value="4" style="color: #ddd; cursor: pointer; font-size: 24px;"></i>
                        <i class="fas fa-star rating-star" data-value="5" style="color: #ddd; cursor: pointer; font-size: 24px;"></i>
                    </div>
                    <input type="hidden" id="riderRatingValue" value="0">
                </div>
                <button class="btn btn-primary" id="submitComplaintBtn">Submit Complaint</button>
            </div>
        </div>
    </div>

    <!-- Add Rider Modal -->
    <div class="modal" id="addRiderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Rider</h3>
                <button class="btn" id="closeAddRiderModal" style="width: auto; background: none; color: var(--gray);">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Rider Name</label>
                    <input type="text" class="form-input" id="newRiderName" placeholder="Enter rider name">
                    <div class="error-message" id="newRiderNameError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">WhatsApp Number</label>
                    <input type="tel" class="form-input" id="newRiderPhone" placeholder="0301-1234567">
                    <div class="error-message" id="newRiderPhoneError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Email (Optional)</label>
                    <input type="email" class="form-input" id="newRiderEmail" placeholder="rider@example.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Rider ID (5 digits)</label>
                    <input type="text" class="form-input" id="newRiderId" placeholder="54365" maxlength="5">
                    <div class="error-message" id="newRiderIdError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="newRiderPassword" placeholder="Create password">
                    <div class="error-message" id="newRiderPasswordError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Confirm Password</label>
                    <input type="password" class="form-input" id="newRiderConfirmPassword" placeholder="Confirm password">
                    <div class="error-message" id="newRiderConfirmPasswordError"></div>
                </div>
                <button class="btn btn-primary" id="saveRiderBtn">Add Rider</button>
            </div>
        </div>
    </div>

    <!-- Add Admin Modal -->
    <div class="modal" id="addAdminModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Admin</h3>
                <button class="btn" id="closeAddAdminModal" style="width: auto; background: none; color: var(--gray);">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Admin Name</label>
                    <input type="text" class="form-input" id="newAdminName" placeholder="Enter admin name">
                    <div class="error-message" id="newAdminNameError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="newAdminEmail" placeholder="admin@example.com">
                    <div class="error-message" id="newAdminEmailError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="newAdminPassword" placeholder="Create password">
                    <div class="error-message" id="newAdminPasswordError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Confirm Password</label>
                    <input type="password" class="form-input" id="newAdminConfirmPassword" placeholder="Confirm password">
                    <div class="error-message" id="newAdminConfirmPasswordError"></div>
                </div>
                <button class="btn btn-primary" id="saveAdminBtn">Add Admin</button>
            </div>
        </div>
    </div>

    <!-- Ride Offer Modal -->
    <div class="modal" id="rideOfferModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Send Ride Offer</h3>
                <button class="btn" id="closeRideOfferModal" style="width: auto; background: none; color: var(--gray);">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div style="background: var(--light-gray); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <h4 style="color: var(--primary); margin-bottom: 10px;">Ride Details</h4>
                    <p><strong>Customer:</strong> <span id="offerCustomerName">-</span></p>
                    <p><strong>Phone:</strong> <span id="offerCustomerPhone">-</span></p>
                    <p><strong>From:</strong> <span id="offerPickup">-</span></p>
                    <p><strong>To:</strong> <span id="offerDestination">-</span></p>
                    <p><strong>Vehicle:</strong> <span id="offerVehicle">-</span></p>
                    <p><strong>Requested Time:</strong> <span id="offerTime">-</span></p>
                </div>
                <div class="form-group">
                    <label class="form-label">Your Fare Offer (Rs.)</label>
                    <input type="number" class="form-input" id="fareOffer" placeholder="Enter your fare offer" min="50" step="10">
                    <div class="error-message" id="fareOfferError"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Estimated Arrival Time (minutes)</label>
                    <input type="number" class="form-input" id="estimatedTime" placeholder="e.g., 15" min="5" max="60">
                </div>
                <div class="form-group">
                    <label class="form-label">Additional Message (Optional)</label>
                    <textarea class="form-input" id="offerMessage" rows="3" placeholder="Add a message for the customer..."></textarea>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-danger" id="declineRideBtn" style="flex: 1;">
                        <i class="fas fa-times"></i> Decline
                    </button>
                    <button class="btn btn-success" id="submitOfferBtn" style="flex: 1;">
                        <i class="fas fa-paper-plane"></i> Send Offer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Rating Modal -->
    <div class="modal" id="ratingModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Rate Your Ride</h3>
                <button class="btn" id="closeRatingModal" style="width: auto; background: none; color: var(--gray);">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Rate your experience (1-5 stars)</label>
                    <div style="display: flex; gap: 5px; margin-top: 10px; margin-bottom: 20px;">
                        <i class="fas fa-star ride-rating-star" data-value="1" style="color: #ddd; cursor: pointer; font-size: 32px;"></i>
                        <i class="fas fa-star ride-rating-star" data-value="2" style="color: #ddd; cursor: pointer; font-size: 32px;"></i>
                        <i class="fas fa-star ride-rating-star" data-value="3" style="color: #ddd; cursor: pointer; font-size: 32px;"></i>
                        <i class="fas fa-star ride-rating-star" data-value="4" style="color: #ddd; cursor: pointer; font-size: 32px;"></i>
                        <i class="fas fa-star ride-rating-star" data-value="5" style="color: #ddd; cursor: pointer; font-size: 32px;"></i>
                    </div>
                    <input type="hidden" id="rideRatingValue" value="0">
                </div>
                <div class="form-group">
                    <label class="form-label">Comments (Optional)</label>
                    <textarea class="form-input" id="rideComments" rows="3" placeholder="Share your experience..."></textarea>
                </div>
                <button class="btn btn-primary" id="submitRatingBtn">Submit Rating</button>
                <button class="btn btn-secondary" id="skipRatingBtn">Skip Rating</button>
            </div>
        </div>
    </div>

    <!-- Notification Panel -->
    <div class="modal" id="notificationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Notifications</h3>
                <button class="btn" id="closeNotificationModal" style="width: auto; background: none; color: var(--gray);">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="notificationList"></div>
            </div>
        </div>
    </div>

    <!-- Complaints Modal -->
    <div class="modal" id="complaintsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Customer Complaints</h3>
                <button class="btn" id="closeComplaintsModal" style="width: auto; background: none; color: var(--gray);">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="complaintsList"></div>
            </div>
        </div>
    </div>

    <!-- Ride Details Modal -->
    <div class="modal" id="rideDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ride Details</h3>
                <button class="btn" id="closeRideDetailsModal" style="width: auto; background: none; color: var(--gray);">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="rideDetailsContent"></div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('loginContainer').style.display = 'flex';
                }, 500);
            }, 1500);

            initApp();
        });

        // Main application class
        class AdvancedRideHailingApp {
            constructor() {
                this.currentUser = null;
                this.currentRole = null;
                this.customerMap = null;
                this.riderMap = null;
                this.activeRide = null;
                this.selectedVehicle = 'bike';
                this.riderMarkers = [];
                this.userMarker = null;
                this.riderLocationMarker = null;
                this.notifications = [];
                this.currentRideRequest = null;
                this.locationWatchId = null;
                this.isRiderOnline = false;
                
                // Initialize storage
                this.initStorage();
                
                // Setup event listeners
                this.setupEventListeners();
                
                // Initialize maps
                this.initMaps();
            }

            initStorage() {
                // Initialize localStorage if not exists
                const defaults = {
                    customers: [
                        { 
                            id: "cust001", 
                            phone: "0301-1234567", 
                            name: "Ali Khan", 
                            email: "ali@example.com",
                            password: "customer123", 
                            createdAt: new Date().toISOString(), 
                            totalRides: 0,
                            rating: 0,
                            rideHistory: [],
                            complaints: 0
                        }
                    ],
                    riders: [
                        { 
                            id: "54321", 
                            name: "Ahmed Raza", 
                            phone: "0301-7654321", 
                            email: "ahmed@example.com",
                            password: "rider123", 
                            totalRides: 0, 
                            rating: 0, 
                            earnings: 0,
                            status: "active",
                            isOnline: false,
                            rideHistory: [],
                            joinDate: new Date().toISOString(),
                            vehicle: "bike",
                            badges: []
                        }
                    ],
                    admins: [
                        { name: 'admin', password: 'admin123', email: 'admin@landriders.com' },
                        { name: 'safeer', password: 'safeer786', email: 'safeer@landriders.com' }
                    ],
                    rides: [],
                    complaints: [],
                    notifications: [],
                    activeRiders: [],
                    rideRequests: [],
                    activeRides: [],
                    settings: {
                        baseFareBike: 50,
                        baseFareCar: 200,
                        perKmBike: 20,
                        perKmCar: 50,
                        minFare: 50,
                        commissionRate: 0.1 // 10% commission
                    },
                    systemStats: {
                        totalRides: 0,
                        totalRevenue: 0,
                        totalCustomers: 1,
                        totalRiders: 1,
                        pendingComplaints: 0
                    }
                };

                // Initialize each storage item
                Object.keys(defaults).forEach(key => {
                    if (!localStorage.getItem(`landRiders_${key}`)) {
                        localStorage.setItem(`landRiders_${key}`, JSON.stringify(defaults[key]));
                    }
                });
            }

            setupEventListeners() {
                // Login tabs
                document.querySelectorAll('.login-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => this.switchLoginTab(e.target.dataset.tab));
                });

                // Customer login/register
                document.getElementById('customerLoginBtn').addEventListener('click', () => this.loginCustomer());
                document.getElementById('customerRegisterBtn').addEventListener('click', () => this.showRegisterForm());
                document.getElementById('registerBtn').addEventListener('click', () => this.registerCustomer());
                document.getElementById('backToLoginBtn').addEventListener('click', () => this.showLoginForm());

                // Rider login
                document.getElementById('riderLoginBtn').addEventListener('click', () => this.loginRider());
                document.getElementById('whatsappBtn').addEventListener('click', () => this.openWhatsApp());

                // Admin login
                document.getElementById('adminLoginBtn').addEventListener('click', () => this.loginAdmin());

                // Logout buttons
                document.getElementById('logoutBtn').addEventListener('click', () => this.logout());
                document.getElementById('riderLogoutBtn').addEventListener('click', () => this.logout());
                document.getElementById('adminLogoutBtn').addEventListener('click', () => this.logout());

                // Customer dashboard
                document.getElementById('findRidesBtn').addEventListener('click', () => this.findRides());
                document.getElementById('complaintBtn').addEventListener('click', () => this.openComplaintModal());
                document.getElementById('notificationBtn').addEventListener('click', () => this.showNotifications());
                document.getElementById('cancelRideBtn').addEventListener('click', () => this.cancelRide());
                document.getElementById('contactRiderBtn').addEventListener('click', () => this.contactRider());

                // Vehicle selection
                document.querySelectorAll('.vehicle-option').forEach(option => {
                    option.addEventListener('click', (e) => this.selectVehicle(e.currentTarget.dataset.type));
                });

                // Rider dashboard
                document.getElementById('onlineToggle').addEventListener('change', (e) => this.toggleOnlineStatus(e.target.checked));
                document.getElementById('arrivedBtn').addEventListener('click', () => this.markArrived());
                document.getElementById('completeRideBtn').addEventListener('click', () => this.completeRide());
                document.getElementById('riderNotificationBtn').addEventListener('click', () => this.showNotifications());

                // Rider tabs
                document.querySelectorAll('#riderTabs .tab-btn').forEach(tab => {
                    tab.addEventListener('click', (e) => this.switchRiderTab(e.target.dataset.tab));
                });

                // Admin tabs
                document.querySelectorAll('#adminTabs .tab-btn').forEach(tab => {
                    tab.addEventListener('click', (e) => this.switchAdminTab(e.target.dataset.tab));
                });

                // Admin dashboard
                document.getElementById('addRiderBtn').addEventListener('click', () => this.openAddRiderModal());
                document.getElementById('addAdminBtn').addEventListener('click', () => this.openAddAdminModal());
                document.getElementById('viewComplaintsBtn').addEventListener('click', () => this.viewComplaints());
                document.getElementById('saveSettingsBtn').addEventListener('click', () => this.saveSettings());
                document.getElementById('exportRidersBtn').addEventListener('click', () => this.exportRidersData());

                // Filter buttons
                document.getElementById('filterTodayBtn').addEventListener('click', () => this.filterRides('today'));
                document.getElementById('filterWeekBtn').addEventListener('click', () => this.filterRides('week'));
                document.getElementById('filterMonthBtn').addEventListener('click', () => this.filterRides('month'));
                document.getElementById('filterAllBtn').addEventListener('click', () => this.filterRides('all'));

                // Search inputs
                document.getElementById('searchRiders').addEventListener('input', (e) => this.searchRiders(e.target.value));
                document.getElementById('searchCustomers').addEventListener('input', (e) => this.searchCustomers(e.target.value));
                document.getElementById('searchRides').addEventListener('input', (e) => this.searchRides(e.target.value));
                document.getElementById('searchComplaints').addEventListener('input', (e) => this.searchComplaints(e.target.value));
                document.getElementById('riderHistorySearch').addEventListener('input', (e) => this.searchRiderHistory(e.target.value));

                // Modals
                document.getElementById('closeComplaintModal').addEventListener('click', () => this.closeModal('complaintModal'));
                document.getElementById('closeAddRiderModal').addEventListener('click', () => this.closeModal('addRiderModal'));
                document.getElementById('closeAddAdminModal').addEventListener('click', () => this.closeModal('addAdminModal'));
                document.getElementById('closeRideOfferModal').addEventListener('click', () => this.closeModal('rideOfferModal'));
                document.getElementById('closeNotificationModal').addEventListener('click', () => this.closeModal('notificationModal'));
                document.getElementById('closeComplaintsModal').addEventListener('click', () => this.closeModal('complaintsModal'));
                document.getElementById('closeRatingModal').addEventListener('click', () => this.closeModal('ratingModal'));
                document.getElementById('closeRideDetailsModal').addEventListener('click', () => this.closeModal('rideDetailsModal'));

                // Form submissions
                document.getElementById('submitComplaintBtn').addEventListener('click', () => this.submitComplaint());
                document.getElementById('saveRiderBtn').addEventListener('click', () => this.saveRider());
                document.getElementById('saveAdminBtn').addEventListener('click', () => this.saveAdmin());
                document.getElementById('submitOfferBtn').addEventListener('click', () => this.submitRideOffer());
                document.getElementById('declineRideBtn').addEventListener('click', () => this.declineRide());
                document.getElementById('submitRatingBtn').addEventListener('click', () => this.submitRating());
                document.getElementById('skipRatingBtn').addEventListener('click', () => this.closeModal('ratingModal'));

                // Rating stars
                document.querySelectorAll('.rating-star').forEach(star => {
                    star.addEventListener('click', (e) => this.setRating(parseInt(e.target.dataset.value)));
                });

                document.querySelectorAll('.ride-rating-star').forEach(star => {
                    star.addEventListener('click', (e) => this.setRideRating(parseInt(e.target.dataset.value)));
                });

                // Auto-detect location
                document.getElementById('pickupLocation').addEventListener('click', () => this.detectLocation('pickup'));
                document.getElementById('destinationLocation').addEventListener('click', () => this.detectLocation('destination'));

                // Real-time updates
                setInterval(() => this.updateRealTimeData(), 5000); // Update every 5 seconds
            }

            initMaps() {
                // Muzaffarabad coordinates
                const muzaffarabad = [34.3700, 73.4711];
                
                // Customer map
                this.customerMap = L.map('map').setView(muzaffarabad, 13);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: ' OpenStreetMap contributors'
                }).addTo(this.customerMap);

                // Add custom marker for Muzaffarabad
                L.marker(muzaffarabad).addTo(this.customerMap)
                    .bindPopup('<b>Muzaffarabad City Center</b>')
                    .openPopup();

                // Rider map
                this.riderMap = L.map('riderMap').setView(muzaffarabad, 13);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: ' OpenStreetMap contributors'
                }).addTo(this.riderMap);
            }

            switchLoginTab(tab) {
                // Update active tab
                document.querySelectorAll('.login-tab').forEach(t => t.classList.remove('active'));
                document.querySelector(`.login-tab[data-tab="${tab}"]`).classList.add('active');

                // Show appropriate form
                document.querySelectorAll('.login-form').forEach(form => form.style.display = 'none');
                document.getElementById(`${tab}LoginForm`).style.display = 'block';

                // Reset forms
                this.resetForms();
            }

            showRegisterForm() {
                document.getElementById('customerLoginForm').style.display = 'none';
                document.getElementById('customerRegisterForm').style.display = 'block';
            }

            showLoginForm() {
                document.getElementById('customerRegisterForm').style.display = 'none';
                document.getElementById('customerLoginForm').style.display = 'block';
            }

            resetForms() {
                // Clear all form inputs
                document.querySelectorAll('.form-input').forEach(input => {
                    if (input.type !== 'submit') {
                        input.value = '';
                    }
                });
                
                // Clear error messages
                document.querySelectorAll('.error-message').forEach(error => {
                    error.style.display = 'none';
                    error.textContent = '';
                });
            }

            showError(elementId, message) {
                const errorElement = document.getElementById(elementId);
                errorElement.textContent = message;
                errorElement.style.display = 'block';
            }

            hideError(elementId) {
                const errorElement = document.getElementById(elementId);
                errorElement.style.display = 'none';
            }

            async loginCustomer() {
                const phone = document.getElementById('customerPhone').value.trim();
                const password = document.getElementById('customerPassword').value.trim();

                // Clear previous errors
                this.hideError('customerPhoneError');
                this.hideError('customerPasswordError');

                // Validation
                if (!phone) {
                    this.showError('customerPhoneError', 'Phone number is required');
                    return;
                }

                if (!password) {
                    this.showError('customerPasswordError', 'Password is required');
                    return;
                }

                const customers = JSON.parse(localStorage.getItem('landRiders_customers'));
                const customer = customers.find(c => c.phone === phone && c.password === password);

                if (customer) {
                    this.currentUser = customer;
                    this.currentRole = 'customer';
                    
                    // Proceed to dashboard without location check
                    this.showDashboard();
                } else {
                    this.showError('customerPasswordError', 'Invalid phone number or password');
                }
            }

            async registerCustomer() {
                const phone = document.getElementById('regPhone').value.trim();
                const name = document.getElementById('regName').value.trim();
                const email = document.getElementById('regEmail').value.trim();
                const password = document.getElementById('regPassword').value;
                const confirmPassword = document.getElementById('regConfirmPassword').value;

                // Clear previous errors
                this.hideError('regPhoneError');
                this.hideError('regNameError');
                this.hideError('regEmailError');
                this.hideError('regPasswordError');
                this.hideError('regConfirmPasswordError');

                // Validation
                let isValid = true;

                if (!phone) {
                    this.showError('regPhoneError', 'Phone number is required');
                    isValid = false;
                }

                if (!name) {
                    this.showError('regNameError', 'Name is required');
                    isValid = false;
                } else if (name.length < 3) {
                    this.showError('regNameError', 'Name must be at least 3 characters');
                    isValid = false;
                }

                if (email && !/\S+@\S+\.\S+/.test(email)) {
                    this.showError('regEmailError', 'Invalid email format');
                    isValid = false;
                }

                if (!password) {
                    this.showError('regPasswordError', 'Password is required');
                    isValid = false;
                } else if (password.length < 6) {
                    this.showError('regPasswordError', 'Password must be at least 6 characters');
                    isValid = false;
                }

                if (!confirmPassword) {
                    this.showError('regConfirmPasswordError', 'Please confirm password');
                    isValid = false;
                } else if (password !== confirmPassword) {
                    this.showError('regConfirmPasswordError', 'Passwords do not match');
                    isValid = false;
                }

                if (!isValid) return;

                // Check if phone already registered
                const customers = JSON.parse(localStorage.getItem('landRiders_customers'));
                if (customers.find(c => c.phone === phone)) {
                    this.showError('regPhoneError', 'Phone number already registered');
                    return;
                }

                // Create customer
                const customer = {
                    id: this.generateId('CUST'),
                    phone: phone,
                    name: name,
                    email: email || '',
                    password: password,
                    createdAt: new Date().toISOString(),
                    totalRides: 0,
                    rating: 0,
                    rideHistory: [],
                    complaints: 0,
                    status: 'active'
                };

                customers.push(customer);
                localStorage.setItem('landRiders_customers', JSON.stringify(customers));

                // Update system stats
                this.updateSystemStats();

                alert('Registration successful! Please login.');
                this.showLoginForm();
            }

            async loginRider() {
                const riderId = document.getElementById('riderId').value.trim();
                const password = document.getElementById('riderPassword').value;

                // Clear previous errors
                this.hideError('riderIdError');
                this.hideError('riderPasswordError');

                // Validation
                if (!riderId) {
                    this.showError('riderIdError', 'Rider ID is required');
                    return;
                }

                if (!password) {
                    this.showError('riderPasswordError', 'Password is required');
                    return;
                }

                const riders = JSON.parse(localStorage.getItem('landRiders_riders'));
                const rider = riders.find(r => r.id === riderId && r.password === password);

                if (rider) {
                    this.currentUser = rider;
                    this.currentRole = 'rider';
                    
                    // Check if rider was previously online
                    const activeRiders = JSON.parse(localStorage.getItem('landRiders_activeRiders'));
                    const isActive = activeRiders.find(r => r.id === riderId);
                    
                    if (isActive) {
                        document.getElementById('onlineToggle').checked = true;
                        this.isRiderOnline = true;
                        this.startLocationTracking();
                    }
                    
                    this.showDashboard();
                } else {
                    this.showError('riderPasswordError', 'Invalid rider ID or password');
                }
            }

            async loginAdmin() {
                const name = document.getElementById('adminName').value.trim();
                const password = document.getElementById('adminPassword').value;

                // Clear previous errors
                this.hideError('adminNameError');
                this.hideError('adminPasswordError');

                // Validation
                if (!name) {
                    this.showError('adminNameError', 'Admin name is required');
                    return;
                }

                if (!password) {
                    this.showError('adminPasswordError', 'Password is required');
                    return;
                }

                const admins = JSON.parse(localStorage.getItem('landRiders_admins'));
                const admin = admins.find(a => a.name === name && a.password === password);

                if (admin) {
                    this.currentUser = admin;
                    this.currentRole = 'admin';
                    this.showDashboard();
                } else {
                    this.showError('adminPasswordError', 'Invalid admin credentials');
                }
            }

            showDashboard() {
                // Hide all containers
                document.getElementById('loginContainer').style.display = 'none';
                document.querySelectorAll('.container').forEach(container => {
                    container.style.display = 'none';
                });

                // Show appropriate dashboard
                if (this.currentRole === 'customer') {
                    document.getElementById('customerDashboard').style.display = 'block';
                    document.getElementById('customerName').textContent = this.currentUser.name;
                    document.getElementById('customerAvatar').textContent = this.currentUser.name.charAt(0).toUpperCase();
                    this.updateCustomerMap();
                    this.loadNotifications();
                    this.checkActiveRide();
                    this.updateCustomerStats();
                } else if (this.currentRole === 'rider') {
                    document.getElementById('riderDashboard').style.display = 'block';
                    document.getElementById('riderName').textContent = this.currentUser.name;
                    document.getElementById('riderIdDisplay').textContent = this.currentUser.id;
                    document.getElementById('riderAvatar').textContent = this.currentUser.name.charAt(0).toUpperCase();
                    this.updateRiderStats();
                    this.loadRiderNotifications();
                    this.checkRiderActiveRide();
                    this.loadRideRequests();
                    this.loadRiderHistory();
                } else if (this.currentRole === 'admin') {
                    document.getElementById('adminDashboard').style.display = 'block';
                    document.getElementById('adminNameDisplay').textContent = this.currentUser.name;
                    this.updateAdminDashboard();
                    this.loadSystemInfo();
                    this.loadSettings();
                }
            }

            logout() {
                // Stop location tracking if active
                if (this.locationWatchId) {
                    navigator.geolocation.clearWatch(this.locationWatchId);
                    this.locationWatchId = null;
                }
                
                // Go offline if rider
                if (this.currentRole === 'rider' && this.isRiderOnline) {
                    this.goOffline();
                }
                
                this.currentUser = null;
                this.currentRole = null;
                this.activeRide = null;
                
                document.querySelectorAll('.container').forEach(container => {
                    container.style.display = 'none';
                });
                
                document.getElementById('loginContainer').style.display = 'flex';
                this.switchLoginTab('customer');
            }

            updateCustomerMap() {
                // Clear existing markers
                this.riderMarkers.forEach(marker => this.customerMap.removeLayer(marker));
                this.riderMarkers = [];

                // Get active riders
                const activeRiders = JSON.parse(localStorage.getItem('landRiders_activeRiders'));
                const riders = JSON.parse(localStorage.getItem('landRiders_riders'));

                // Add markers for active riders
                activeRiders.forEach(activeRider => {
                    const rider = riders.find(r => r.id === activeRider.id);
                    if (rider && activeRider.location) {
                        const marker = L.marker([activeRider.location.lat, activeRider.location.lng], {
                            icon: L.divIcon({
                                html: `<div style="background-color: ${this.selectedVehicle === 'bike' ? '#2E7D32' : '#1B5E20'}; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; border: 3px solid #FFD600;">
                                    <i class="fas fa-${this.selectedVehicle === 'bike' ? 'motorcycle' : 'car'}"></i>
                                </div>`
                            })
                        }).addTo(this.customerMap);

                        marker.bindPopup(`
                            <div style="min-width: 200px;">
                                <h4 style="margin-bottom: 5px;">${rider.name}</h4>
                                <p><strong>ID:</strong> ${rider.id}</p>
                                <p><strong>Vehicle:</strong> ${this.selectedVehicle === 'bike' ? 'Bike' : 'Car'}</p>
                                <p><strong>Rating:</strong>  ${rider.rating ? rider.rating.toFixed(1) : '0.0'}</p>
                                <p><strong>Status:</strong> <span class="status-indicator status-online">Online</span></p>
                                <button onclick="app.requestRideFromMap('${rider.id}')" style="background: #2E7D32; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-top: 10px; width: 100%;">
                                    Request Ride
                                </button>
                            </div>
                        `);

                        this.riderMarkers.push(marker);
                    }
                });

                // Center map on user's location if available
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition((position) => {
                        const userLocation = [position.coords.latitude, position.coords.longitude];
                        this.customerMap.setView(userLocation, 15);
                        
                        // Remove previous user marker
                        if (this.userMarker) {
                            this.customerMap.removeLayer(this.userMarker);
                        }
                        
                        // Add user marker
                        this.userMarker = L.marker(userLocation, {
                            icon: L.divIcon({
                                html: `<div style="background-color: #2196F3; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; border: 3px solid white;">
                                    <i class="fas fa-user"></i>
                                </div>`
                            })
                        }).addTo(this.customerMap).bindPopup('<b>Your Location</b>');
                        
                        // Set pickup location automatically
                        this.reverseGeocode(userLocation, 'pickup');
                    }, () => {
                        // Default to Muzaffarabad center
                        this.customerMap.setView([34.3700, 73.4711], 13);
                    });
                } else {
                    // Default to Muzaffarabad center
                    this.customerMap.setView([34.3700, 73.4711], 13);
                }
            }

            selectVehicle(type) {
                this.selectedVehicle = type;
                document.querySelectorAll('.vehicle-option').forEach(option => {
                    option.classList.remove('active');
                });
                document.querySelector(`.vehicle-option[data-type="${type}"]`).classList.add('active');
                this.updateCustomerMap();
            }

            async findRides() {
                const pickup = document.getElementById('pickupLocation').value.trim();
                const destination = document.getElementById('destinationLocation').value.trim();

                if (!pickup) {
                    alert('Please enter pickup location');
                    return;
                }

                if (!destination) {
                    alert('Please enter destination');
                    return;
                }

                if (pickup === destination) {
                    alert('Pickup and destination cannot be the same');
                    return;
                }

                // Calculate estimated fare
                const settings = JSON.parse(localStorage.getItem('landRiders_settings'));
                const baseFare = this.selectedVehicle === 'bike' ? settings.baseFareBike : settings.baseFareCar;
                const estimatedFare = Math.max(baseFare, settings.minFare);

                // Create ride request
                const rideRequest = {
                    id: this.generateId('REQ'),
                    customerId: this.currentUser.id,
                    customerName: this.currentUser.name,
                    customerPhone: this.currentUser.phone,
                    customerEmail: this.currentUser.email,
                    pickup: pickup,
                    destination: destination,
                    vehicle: this.selectedVehicle,
                    estimatedFare: estimatedFare,
                    status: 'pending',
                    timestamp: new Date().toISOString(),
                    offers: []
                };

                // Save ride request
                const rideRequests = JSON.parse(localStorage.getItem('landRiders_rideRequests') || '[]');
                rideRequests.push(rideRequest);
                localStorage.setItem('landRiders_rideRequests', JSON.stringify(rideRequests));

                // Notify active riders
                this.notifyRiders(rideRequest);

                // Show offers section
                document.getElementById('rideOffersSection').style.display = 'block';
                document.getElementById('rideOffers').innerHTML = '<p style="text-align: center; color: var(--gray); padding: 20px;">Waiting for riders to send offers...</p>';

                alert('Ride request sent to available riders. You will receive offers shortly.');
            }

            notifyRiders(rideRequest) {
                const activeRiders = JSON.parse(localStorage.getItem('landRiders_activeRiders'));
                const riders = JSON.parse(localStorage.getItem('landRiders_riders'));
                const notifications = JSON.parse(localStorage.getItem('landRiders_notifications') || '[]');

                activeRiders.forEach(activeRider => {
                    const rider = riders.find(r => r.id === activeRider.id);
                    if (rider && rider.vehicle === rideRequest.vehicle) {
                        const notification = {
                            id: this.generateId('NOT'),
                            riderId: rider.id,
                            type: 'ride_request',
                            title: 'New Ride Request',
                            message: `${rideRequest.customerName} needs a ${rideRequest.vehicle} from ${rideRequest.pickup} to ${rideRequest.destination}`,
                            data: rideRequest,
                            read: false,
                            timestamp: new Date().toISOString(),
                            priority: 'high'
                        };

                        notifications.push(notification);
                    }
                });

                localStorage.setItem('landRiders_notifications', JSON.stringify(notifications));
            }

            toggleOnlineStatus(online) {
                if (online) {
                    // Try to get location but don't require it
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(
                            (position) => {
                                this.goOnline(position);
                            },
                            (error) => {
                                // Location permission not granted, but still go online with default location
                                console.log("Location permission not granted, using default location");
                                this.goOnlineWithDefault();
                            }
                        );
                    } else {
                        // Geolocation not supported, go online with default location
                        this.goOnlineWithDefault();
                    }
                } else {
                    this.goOffline();
                }
            }

            goOnlineWithDefault() {
                const muzaffarabad = [34.3700, 73.4711];
                this.goOnline({
                    coords: {
                        latitude: muzaffarabad[0],
                        longitude: muzaffarabad[1]
                    }
                });
            }

            goOnline(position) {
                const activeRiders = JSON.parse(localStorage.getItem('landRiders_activeRiders') || '[]');
                
                // Remove if already exists
                const index = activeRiders.findIndex(r => r.id === this.currentUser.id);
                if (index !== -1) {
                    activeRiders.splice(index, 1);
                }

                // Add rider with location
                activeRiders.push({
                    id: this.currentUser.id,
                    name: this.currentUser.name,
                    location: {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    },
                    vehicle: this.currentUser.vehicle || 'bike',
                    rating: this.currentUser.rating || 0,
                    lastUpdate: new Date().toISOString(),
                    status: 'available'
                });

                localStorage.setItem('landRiders_activeRiders', JSON.stringify(activeRiders));

                // Update rider status
                const riders = JSON.parse(localStorage.getItem('landRiders_riders'));
                const riderIndex = riders.findIndex(r => r.id === this.currentUser.id);
                if (riderIndex !== -1) {
                    riders[riderIndex].isOnline = true;
                    localStorage.setItem('landRiders_riders', JSON.stringify(riders));
                }

                // Update UI
                document.getElementById('locationStatus').innerHTML = `
                    <i class="fas fa-map-marker" style="color: var(--success);"></i> 
                    <span class="status-indicator status-online">Online - Available for rides</span>
                `;

                // Update rider map
                this.updateRiderMap(position.coords.latitude, position.coords.longitude);

                // Start location tracking
                this.startLocationTracking();

                this.isRiderOnline = true;
                
                alert('You are now online and visible to customers!');
                
                // Load ride requests
                this.loadRideRequests();
            }

            goOffline() {
                const activeRiders = JSON.parse(localStorage.getItem('landRiders_activeRiders') || '[]');
                const index = activeRiders.findIndex(r => r.id === this.currentUser.id);
                
                if (index !== -1) {
                    activeRiders.splice(index, 1);
                    localStorage.setItem('landRiders_activeRiders', JSON.stringify(activeRiders));
                }

                // Update rider status
                const riders = JSON.parse(localStorage.getItem('landRiders_riders'));
                const riderIndex = riders.findIndex(r => r.id === this.currentUser.id);
                if (riderIndex !== -1) {
                    riders[riderIndex].isOnline = false;
                    localStorage.setItem('landRiders_riders', JSON.stringify(riders));
                }

                // Stop location tracking
                if (this.locationWatchId) {
                    navigator.geolocation.clearWatch(this.locationWatchId);
                    this.locationWatchId = null;
                }

                document.getElementById('locationStatus').innerHTML = `
                    <i class="fas fa-map-marker"></i> 
                    <span class="status-indicator status-offline">Offline</span>
                `;

                this.isRiderOnline = false;
                alert('You are now offline');
            }

            startLocationTracking() {
                if (navigator.geolocation && this.isRiderOnline) {
                    this.locationWatchId = navigator.geolocation.watchPosition(
                        (position) => {
                            this.updateRiderLocation(position);
                        },
                        (error) => {
                            console.error("Error getting location:", error);
                        },
                        {
                            enableHighAccuracy: true,
                            maximumAge: 10000,
                            timeout: 5000
                        }
                    );
                }
            }

            updateRiderLocation(position) {
                const activeRiders = JSON.parse(localStorage.getItem('landRiders_activeRiders') || '[]');
                const index = activeRiders.findIndex(r => r.id === this.currentUser.id);
                
                if (index !== -1) {
                    activeRiders[index].location = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    activeRiders[index].lastUpdate = new Date().toISOString();
                    
                    localStorage.setItem('landRiders_activeRiders', JSON.stringify(activeRiders));

                    // Update rider map
                    this.updateRiderMap(position.coords.latitude, position.coords.longitude);
                }
            }

            updateRiderMap(lat, lng) {
                // Clear previous marker
                if (this.riderLocationMarker) {
                    this.riderMap.removeLayer(this.riderLocationMarker);
                }
                
                // Center map on rider location
                this.riderMap.setView([lat, lng], 15);
                
                // Add new marker
                this.riderLocationMarker = L.marker([lat, lng], {
                    icon: L.divIcon({
                        html: `<div style="background-color: #2E7D32; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; border: 3px solid #FFD600;">
                            <i class="fas fa-motorcycle"></i>
                        </div>`
                    })
                }).addTo(this.riderMap).bindPopup('<b>Your Location</b><br>Visible to customers');
            }

            openWhatsApp() {
                const phone = '03013036146';
                const message = 'Hello, I want to become a rider for THE LAND RIDERS. Please provide me with rider registration details.';
                window.open(`https://wa.me/${phone}?text=${encodeURIComponent(message)}`, '_blank');
            }

            openComplaintModal() {
                document.getElementById('complaintModal').style.display = 'flex';
            }

            setRating(rating) {
                document.getElementById('riderRatingValue').value = rating;
                document.querySelectorAll('.rating-star').forEach((star, index) => {
                    if (index < rating) {
                        star.style.color = '#FFD600';
                    } else {
                        star.style.color = '#ddd';
                    }
                });
            }

            setRideRating(rating) {
                document.getElementById('rideRatingValue').value = rating;
                document.querySelectorAll('.ride-rating-star').forEach((star, index) => {
                    if (index < rating) {
                        star.style.color = '#FFD600';
                    } else {
                        star.style.color = '#ddd';
                    }
                });
            }

            async submitComplaint() {
                const riderName = document.getElementById('complaintRiderName').value.trim();
                const riderId = document.getElementById('complaintRiderId').value.trim();
                const details = document.getElementById('complaintDetails').value.trim();
                const rating = parseInt(document.getElementById('riderRatingValue').value);

                // Clear previous errors
                this.hideError('complaintRiderNameError');
                this.hideError('complaintDetailsError');

                // Validation
                let isValid = true;

                if (!riderName) {
                    this.showError('complaintRiderNameError', 'Rider name is required');
                    isValid = false;
                }

                if (!details) {
                    this.showError('complaintDetailsError', 'Please describe the issue');
                    isValid = false;
                } else if (details.length < 10) {
                    this.showError('complaintDetailsError', 'Please provide more details (min 10 characters)');
                    isValid = false;
                }

                if (rating === 0) {
                    alert('Please rate the rider');
                    isValid = false;
                }

                if (!isValid) return;

                const complaint = {
                    id: this.generateId('COMP'),
                    customerId: this.currentUser.id,
                    customerName: this.currentUser.name,
                    customerPhone: this.currentUser.phone,
                    customerEmail: this.currentUser.email,
                    riderName: riderName,
                    riderId: riderId || 'Unknown',
                    details: details,
                    rating: rating,
                    status: 'pending',
                    timestamp: new Date().toISOString(),
                    resolved: false,
                    adminNotes: ''
                };

                const complaints = JSON.parse(localStorage.getItem('landRiders_complaints') || '[]');
                complaints.push(complaint);
                localStorage.setItem('landRiders_complaints', JSON.stringify(complaints));

                // Update customer complaints count
                const customers = JSON.parse(localStorage.getItem('landRiders_customers'));
                const customerIndex = customers.findIndex(c => c.id === this.currentUser.id);
                if (customerIndex !== -1) {
                    customers[customerIndex].complaints = (customers[customerIndex].complaints || 0) + 1;
                    localStorage.setItem('landRiders_customers', JSON.stringify(customers));
                }

                // Update system stats
                this.updateSystemStats();

                this.closeModal('complaintModal');
                alert('Complaint submitted successfully. Admin will review it.');
            }

            openAddRiderModal() {
                document.getElementById('addRiderModal').style.display = 'flex';
            }

            openAddAdminModal() {
                document.getElementById('addAdminModal').style.display = 'flex';
            }

            async saveRider() {
                const name = document.getElementById('newRiderName').value.trim();
                const phone = document.getElementById('newRiderPhone').value.trim();
                const email = document.getElementById('newRiderEmail').value.trim();
                const riderId = document.getElementById('newRiderId').value.trim();
                const password = document.getElementById('newRiderPassword').value;
                const confirmPassword = document.getElementById('newRiderConfirmPassword').value;

                // Clear previous errors
                this.hideError('newRiderNameError');
                this.hideError('newRiderPhoneError');
                this.hideError('newRiderIdError');
                this.hideError('newRiderPasswordError');
                this.hideError('newRiderConfirmPasswordError');

                // Validation
                let isValid = true;

                if (!name) {
                    this.showError('newRiderNameError', 'Rider name is required');
                    isValid = false;
                }

                if (!phone) {
                    this.showError('newRiderPhoneError', 'Phone number is required');
                    isValid = false;
                }

                if (email && !/\S+@\S+\.\S+/.test(email)) {
                    this.showError('newRiderEmailError', 'Invalid email format');
                    isValid = false;
                }

                if (!riderId) {
                    this.showError('newRiderIdError', 'Rider ID is required');
                    isValid = false;
                } else if (!/^\d{5}$/.test(riderId)) {
                    this.showError('newRiderIdError', 'Rider ID must be 5 digits');
                    isValid = false;
                }

                if (!password) {
                    this.showError('newRiderPasswordError', 'Password is required');
                    isValid = false;
                } else if (password.length < 6) {
                    this.showError('newRiderPasswordError', 'Password must be at least 6 characters');
                    isValid = false;
                }

                if (!confirmPassword) {
                    this.showError('newRiderConfirmPasswordError', 'Please confirm password');
                    isValid = false;
                } else if (password !== confirmPassword) {
                    this.showError('newRiderConfirmPasswordError', 'Passwords do not match');
                    isValid = false;
                }

                if (!isValid) return;

                const riders = JSON.parse(localStorage.getItem('landRiders_riders'));
                
                // Check if rider ID already exists
                if (riders.find(r => r.id === riderId)) {
                    this.showError('newRiderIdError', 'Rider ID already exists');
                    return;
                }

                const rider = {
                    id: riderId,
                    name: name,
                    phone: phone,
                    email: email || '',
                    password: password,
                    totalRides: 0,
                    rating: 0,
                    earnings: 0,
                    status: 'active',
                    isOnline: false,
                    rideHistory: [],
                    joinDate: new Date().toISOString(),
                    vehicle: 'bike',
                    badges: ['New Rider']
                };

                riders.push(rider);
                localStorage.setItem('landRiders_riders', JSON.stringify(riders));

                // Update system stats
                this.updateSystemStats();

                this.closeModal('addRiderModal');
                alert(`Rider ${name} added successfully with ID: ${riderId}`);
                
                // Update admin dashboard
                this.updateAdminDashboard();
            }

            async saveAdmin() {
                const name = document.getElementById('newAdminName').value.trim();
                const email = document.getElementById('newAdminEmail').value.trim();
                const password = document.getElementById('newAdminPassword').value;
                const confirmPassword = document.getElementById('newAdminConfirmPassword').value;

                // Clear previous errors
                this.hideError('newAdminNameError');
                this.hideError('newAdminEmailError');
                this.hideError('newAdminPasswordError');
                this.hideError('newAdminConfirmPasswordError');

                // Validation
                let isValid = true;

                if (!name) {
                    this.showError('newAdminNameError', 'Admin name is required');
                    isValid = false;
                }

                if (!email) {
                    this.showError('newAdminEmailError', 'Email is required');
                    isValid = false;
                } else if (!/\S+@\S+\.\S+/.test(email)) {
                    this.showError('newAdminEmailError', 'Invalid email format');
                    isValid = false;
                }

                if (!password) {
                    this.showError('newAdminPasswordError', 'Password is required');
                    isValid = false;
                } else if (password.length < 6) {
                    this.showError('newAdminPasswordError', 'Password must be at least 6 characters');
                    isValid = false;
                }

                if (!confirmPassword) {
                    this.showError('newAdminConfirmPasswordError', 'Please confirm password');
                    isValid = false;
                } else if (password !== confirmPassword) {
                    this.showError('newAdminConfirmPasswordError', 'Passwords do not match');
                    isValid = false;
                }

                if (!isValid) return;

                const admins = JSON.parse(localStorage.getItem('landRiders_admins'));
                
                // Check if admin already exists
                if (admins.find(a => a.name === name)) {
                    this.showError('newAdminNameError', 'Admin name already exists');
                    return;
                }

                const admin = {
                    name: name,
                    email: email,
                    password: password,
                    createdAt: new Date().toISOString()
                };

                admins.push(admin);
                localStorage.setItem('landRiders_admins', JSON.stringify(admins));

                this.closeModal('addAdminModal');
                alert(`Admin ${name} added successfully`);
            }

            updateRiderStats() {
                const rides = JSON.parse(localStorage.getItem('landRiders_rides') || '[]');
                const today = new Date().toDateString();
                
                const riderRides = rides.filter(ride => ride.riderId === this.currentUser.id);
                const todayRides = riderRides.filter(ride => 
                    new Date(ride.timestamp).toDateString() === today &&
                    ride.status === 'completed'
                ).length;

                const rider = JSON.parse(localStorage.getItem('landRiders_riders')).find(r => r.id === this.currentUser.id);
                
                document.getElementById('todayRides').textContent = todayRides;
                document.getElementById('riderRating').textContent = rider?.rating ? rider.rating.toFixed(1) : '0.0';
                
                // Update rating stars
                const ratingStars = document.querySelectorAll('#riderRating ~ .fa-star');
                const rating = rider?.rating || 0;
                ratingStars.forEach((star, index) => {
                    if (index < Math.floor(rating)) {
                        star.style.color = '#FFD600';
                    } else if (index < rating) {
                        star.style.color = '#FFD600';
                    } else {
                        star.style.color = '#ddd';
                    }
                });
                
                // Calculate today's earnings
                const todayEarnings = riderRides.filter(ride => 
                    new Date(ride.timestamp).toDateString() === today &&
                    ride.status === 'completed'
                ).reduce((total, ride) => total + (parseFloat(ride.fare) || 0), 0);
                
                document.getElementById('todayEarnings').textContent = `Rs. ${todayEarnings}`;
            }

            loadRideRequests() {
                const rideRequests = JSON.parse(localStorage.getItem('landRiders_rideRequests') || '[]');
                const pendingRequests = rideRequests.filter(request => 
                    request.status === 'pending' && 
                    request.vehicle === (this.currentUser.vehicle || 'bike')
                );
                
                const rideRequestsList = document.getElementById('rideRequestsList');
                rideRequestsList.innerHTML = '';

                if (pendingRequests.length === 0) {
                    rideRequestsList.innerHTML = '<p style="text-align: center; color: var(--gray); padding: 20px;">No ride requests available.</p>';
                    return;
                }

                pendingRequests.forEach(request => {
                    const requestCard = document.createElement('div');
                    requestCard.className = 'ride-request-card';
                    
                    requestCard.innerHTML = `
                        <div class="ride-request-header">
                            <div>
                                <h4 style="color: var(--primary); margin-bottom: 5px;">${request.customerName}</h4>
                                <p style="color: var(--gray); font-size: 12px;">
                                    <i class="fas fa-phone"></i> ${request.customerPhone}
                                    ${request.customerEmail ? `<br><i class="fas fa-envelope"></i> ${request.customerEmail}` : ''}
                                </p>
                            </div>
                            <span class="status-indicator status-pending">Pending</span>
                        </div>
                        <div class="ride-request-info">
                            <p><i class="fas fa-map-marker-alt"></i> <strong>From:</strong> ${request.pickup}</p>
                            <p><i class="fas fa-flag-checkered"></i> <strong>To:</strong> ${request.destination}</p>
                            <p><i class="fas fa-car"></i> <strong>Vehicle:</strong> ${request.vehicle}</p>
                            <p><i class="fas fa-clock"></i> <strong>Requested:</strong> ${new Date(request.timestamp).toLocaleTimeString()}</p>
                            <p><i class="fas fa-money-bill-wave"></i> <strong>Estimated Fare:</strong> Rs. ${request.estimatedFare}</p>
                        </div>
                        <div class="ride-request-actions">
                            <button class="btn btn-danger" onclick="app.declineRideRequest('${request.id}')" style="flex: 1;">
                                <i class="fas fa-times"></i> Decline
                            </button>
                            <button class="btn btn-success" onclick="app.acceptRideRequest('${request.id}')" style="flex: 1;">
                                <i class="fas fa-check"></i> Accept
                            </button>
                        </div>
                    `;
                    
                    rideRequestsList.appendChild(requestCard);
                });
            }

            loadRiderHistory() {
                const rides = JSON.parse(localStorage.getItem('landRiders_rides') || '[]');
                const riderRides = rides.filter(ride => ride.riderId === this.currentUser.id)
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                    .slice(0, 20); // Show last 20 rides

                const historyList = document.getElementById('riderHistoryList');
                historyList.innerHTML = '';

                if (riderRides.length === 0) {
                    historyList.innerHTML = '<p style="text-align: center; color: var(--gray); padding: 20px;">No ride history yet.</p>';
                    return;
                }

                riderRides.forEach(ride => {
                    const historyCard = document.createElement('div');
                    historyCard.className = 'ride-request-card';
                    
                    const statusClass = ride.status === 'completed' ? 'status-completed' : 
                                      ride.status === 'cancelled' ? 'status-cancelled' : 'status-pending';
                    
                    historyCard.innerHTML = `
                        <div class="ride-request-header">
                            <div>
                                <h4 style="color: var(--primary); margin-bottom: 5px;">${ride.customerName}</h4>
                                <p style="color: var(--gray); font-size: 12px;">${new Date(ride.timestamp).toLocaleDateString()}</p>
                            </div>
                            <span class="status-indicator ${statusClass}">${ride.status}</span>
                        </div>
                        <div class="ride-request-info">
                            <p><i class="fas fa-map-marker-alt"></i> <strong>From:</strong> ${ride.pickup}</p>
                            <p><i class="fas fa-flag-checkered"></i> <strong>To:</strong> ${ride.destination}</p>
                            <p><i class="fas fa-money-bill-wave"></i> <strong>Fare:</strong> Rs. ${ride.fare}</p>
                            ${ride.rating ? `<p><i class="fas fa-star"></i> <strong>Rating:</strong> ${ride.rating}/5</p>` : ''}
                        </div>
                        <button class="btn btn-secondary" onclick="app.viewRideDetails('${ride.id}')" style="width: 100%;">
                            <i class="fas fa-eye"></i> View Details
                        </button>
                    `;
                    
                    historyList.appendChild(historyCard);
                });
            }

            declineRideRequest(requestId) {
                if (confirm('Are you sure you want to decline this ride request?')) {
                    const rideRequests = JSON.parse(localStorage.getItem('landRiders_rideRequests') || '[]');
                    const requestIndex = rideRequests.findIndex(r => r.id === requestId);
                    
                    if (requestIndex !== -1) {
                        rideRequests[requestIndex].status = 'declined';
                        localStorage.setItem('landRiders_rideRequests', JSON.stringify(rideRequests));
                        
                        this.loadRideRequests();
                        alert('Ride request declined');
                    }
                }
            }

            acceptRideRequest(requestId) {
                const rideRequests = JSON.parse(localStorage.getItem('landRiders_rideRequests') || '[]');
                const request = rideRequests.find(r => r.id === requestId);
                
                if (request) {
                    this.currentRideRequest = request;
                    
                    // Show ride offer modal
                    document.getElementById('offerCustomerName').textContent = request.customerName;
                    document.getElementById('offerCustomerPhone').textContent = request.customerPhone;
                    document.getElementById('offerPickup').textContent = request.pickup;
                    document.getElementById('offerDestination').textContent = request.destination;
                    document.getElementById('offerVehicle').textContent = request.vehicle;
                    document.getElementById('offerTime').textContent = new Date(request.timestamp).toLocaleTimeString();
                    
                    // Set suggested fare
                    document.getElementById('fareOffer').value = request.estimatedFare;
                    
                    document.getElementById('rideOfferModal').style.display = 'flex';
                }
            }

            submitRideOffer() {
                const fare = document.getElementById('fareOffer').value;
                const estimatedTime = document.getElementById('estimatedTime').value;
                const message = document.getElementById('offerMessage').value;
                
                if (!fare || parseFloat(fare) < 50) {
                    alert('Please enter a valid fare amount (minimum Rs. 50)');
                    return;
                }

                if (!this.currentRideRequest) {
                    alert('No ride request found');
                    return;
                }

                const rider = JSON.parse(localStorage.getItem('landRiders_riders')).find(r => r.id === this.currentUser.id);
                
                // Create offer notification
                const notification = {
                    id: this.generateId('NOT'),
                    customerId: this.currentRideRequest.customerId,
                    type: 'ride_offer',
                    title: 'Ride Offer Received',
                    message: `${rider.name} offered Rs. ${fare} for your ride`,
                    data: {
                        ...this.currentRideRequest,
                        fare: fare,
                        estimatedTime: estimatedTime || '15',
                        riderId: this.currentUser.id,
                        riderName: rider.name,
                        riderPhone: rider.phone,
                        riderRating: rider.rating || 0,
                        offerMessage: message
                    },
                    read: false,
                    timestamp: new Date().toISOString(),
                    priority: 'high'
                };

                // Update ride request
                const rideRequests = JSON.parse(localStorage.getItem('landRiders_rideRequests') || '[]');
                const requestIndex = rideRequests.findIndex(r => r.id === this.currentRideRequest.id);
                if (requestIndex !== -1) {
                    rideRequests[requestIndex].offers.push({
                        riderId: this.currentUser.id,
                        riderName: rider.name,
                        fare: fare,
                        estimatedTime: estimatedTime,
                        message: message,
                        timestamp: new Date().toISOString()
                    });
                    localStorage.setItem('landRiders_rideRequests', JSON.stringify(rideRequests));
                }

                const notifications = JSON.parse(localStorage.getItem('landRiders_notifications') || '[]');
                notifications.push(notification);
                localStorage.setItem('landRiders_notifications', JSON.stringify(notifications));

                this.closeModal('rideOfferModal');
                this.currentRideRequest = null;
                alert('Ride offer sent successfully! The customer will be notified.');
                
                // Reload ride requests
                this.loadRideRequests();
            }

            loadRideOffers() {
                const notifications = JSON.parse(localStorage.getItem('landRiders_notifications') || '[]');
                const rideOffers = notifications.filter(n => 
                    n.type === 'ride_offer' && 
                    n.data.customerId === this.currentUser.id
                );

                const rideOffersContainer = document.getElementById('rideOffers');
                rideOffersContainer.innerHTML = '';

                if (rideOffers.length === 0) {
                    rideOffersContainer.innerHTML = '<p style="text-align: center; color: var(--gray); padding: 20px;">No offers yet. Waiting for riders...</p>';
                } else {
                    rideOffers.forEach(offer => {
                        const offerCard = document.createElement('div');
                        offerCard.className = 'offer-card';
                        offerCard.innerHTML = `
                            <div class="offer-header">
                                <div>
                                    <h4>${offer.data.riderName}</h4>
                                    <p style="color: var(--gray); font-size: 14px;">
                                        ID: ${offer.data.riderId} | 
                                        Rating:  ${offer.data.riderRating ? offer.data.riderRating.toFixed(1) : '0.0'} |
                                        ${offer.data.estimatedTime} min
                                    </p>
                                </div>
                                <div class="offer-price">Rs. ${offer.data.fare}</div>
                            </div>
                            ${offer.data.offerMessage ? `<p><i class="fas fa-comment"></i> ${offer.data.offerMessage}</p>` : ''}
                            <div class="offer-actions">
                                <button class="btn btn-danger" onclick="app.rejectOffer('${offer.id}')" style="flex: 1;">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                                <button class="btn btn-success" onclick="app.acceptOffer('${offer.id}')" style="flex: 1;">
                                    <i class="fas fa-check"></i> Accept
                                </button>
                            </div>
                        `;
                        rideOffersContainer.appendChild(offerCard);
                    });
                }
            }

            rejectOffer(offerId) {
                const notifications = JSON.parse(localStorage.getItem('landRiders_notifications') || '[]');
                const index = notifications.findIndex(n => n.id === offerId);
                
                if (index !== -1) {
                    notifications.splice(index, 1);
                    localStorage.setItem('landRiders_notifications', JSON.stringify(notifications));
                    
                    this.loadRideOffers();
                    alert('Offer rejected');
                }
            }

            acceptOffer(offerId) {
                const notifications = JSON.parse(localStorage.getItem('landRiders_notifications') || '[]');
                const offer = notifications.find(n => n.id === offerId);
                
                if (offer) {
                    // Create active ride
                    this.activeRide = {
                        id: this.generateId('RIDE'),
                        customerId: this.currentUser.id,
                        customerName: this.currentUser.name,
                        customerPhone: this.currentUser.phone,
                        customerEmail: this.currentUser.email,
                        riderId: offer.data.riderId,
                        riderName: offer.data.riderName,
                        riderPhone: offer.data.riderPhone,
                        pickup: offer.data.pickup,
                        destination: offer.data.destination,
                        fare: offer.data.fare,
                        estimatedTime: offer.data.estimatedTime,
                        vehicle: offer.data.vehicle,
                        status: 'accepted',
                        timestamp: new Date().toISOString(),
                        acceptedAt: new Date().toISOString()
                    };

                    // Remove all offers for this ride
                    const updatedNotifications = notifications.filter(n => 
                        !(n.type === 'ride_offer' && n.data.customerId === this.currentUser.id)
                    );
                    
                    // Add ride accepted notification for rider
                    const riderNotification = {
                        id: this.generateId('NOT'),
                        riderId: offer.data.riderId,
                        type: 'ride_accepted',
                        title: 'Ride Accepted!',
                        message: `${this.currentUser.name} accepted your offer of Rs. ${offer.data.fare}`,
                        data: this.activeRide,
                        read: false,
                        timestamp: new Date().toISOString(),
                        priority: 'high'
                    };

                    updatedNotifications.push(riderNotification);
                    localStorage.setItem('landRiders_notifications', JSON.stringify(updatedNotifications));

                    // Save active ride
                    const activeRides = JSON.parse(localStorage.getItem('landRiders_activeRides') || '[]');
                    activeRides.push(this.activeRide);
                    localStorage.setItem('landRiders_activeRides', JSON.stringify(activeRides));

                    // Update ride request status
                    const rideRequests = JSON.parse(localStorage.getItem('landRiders_rideRequests') || '[]');
                    const requestIndex = rideRequests.findIndex(r => r.id === offer.data.id);
                    if (requestIndex !== -1) {
                        rideRequests[requestIndex].status = 'accepted';
                        rideRequests[requestIndex].acceptedAt = new Date().toISOString();
                        rideRequests[requestIndex].acceptedBy = offer.data.riderId;
                        localStorage.setItem('landRiders_rideRequests', JSON.stringify(rideRequests));
                    }

                    // Hide offers section, show active ride section
                    document.getElementById('rideOffersSection').style.display = 'none';
                    document.getElementById('activeRideSection').style.display = 'block';
                    
                    // Update active ride info
                    document.getElementById('activeRiderName').textContent = this.activeRide.riderName;
                    document.getElementById('activePickupLocation').textContent = this.activeRide.pickup;
                    document.getElementById('activeDestinationLocation').textContent = this.activeRide.destination;
                    document.getElementById('activeRideFare').textContent = `Rs. ${this.activeRide.fare}`;
                    document.getElementById('activeRiderPhone').textContent = this.activeRide.riderPhone;
                    
                    alert(`Ride accepted! ${offer.data.riderName} is on the way.`);
                    
                    // Update notifications
                    this.loadNotifications();
                }
            }

            checkActiveRide() {
                const activeRides = JSON.parse(localStorage.getItem('landRiders_activeRides') || '[]');
                const activeRide = activeRides.find(ride => ride.customerId === this.currentUser.id && ride.status === 'accepted');
                
                if (activeRide) {
                    this.activeRide = activeRide;
                    document.getElementById('rideOffersSection').style.display = 'none';
                    document.getElementById('activeRideSection').style.display = 'block';
                    
                    document.getElementById('activeRiderName').textContent = activeRide.riderName;
                    document.getElementById('activePickupLocation').textContent = activeRide.pickup;
                    document.getElementById('activeDestinationLocation').textContent = activeRide.destination;
                    document.getElementById('activeRideFare').textContent = `Rs. ${activeRide.fare}`;
                    document.getElementById('activeRiderPhone').textContent = activeRide.riderPhone;
                } else {
                    document.getElementById('activeRideSection').style.display = 'none';
                }
            }

            checkRiderActiveRide() {
                const activeRides = JSON.parse(localStorage.getItem('landRiders_activeRides') || '[]');
                const activeRide = activeRides.find(ride => ride.riderId === this.currentUser.id && ride.status === 'accepted');
                
                if (activeRide) {
                    this.activeRide = activeRide;
                    document.getElementById('activeRideSectionRider').style.display = 'block';
                    
                    document.getElementById('activeCustomerName').textContent = activeRide.customerName;
                    document.getElementById('activeCustomerPhone').textContent = activeRide.customerPhone;
                    document.getElementById('activePickup').textContent = activeRide.pickup;
                    document.getElementById('activeDestination').textContent = activeRide.destination;
                    document.getElementById('activeFare').textContent = `Rs. ${activeRide.fare}`;
                } else {
                    document.getElementById('activeRideSectionRider').style.display = 'none';
                }
            }

            cancelRide() {
                if (this.activeRide && confirm('Are you sure you want to cancel this ride?')) {
                    const activeRides = JSON.parse(localStorage.getItem('landRiders_activeRides') || '[]');
                    const updatedRides = activeRides.filter(ride => ride.id !== this.activeRide.id);
                    localStorage.setItem('landRiders_activeRides', JSON.stringify(updatedRides));
                    
                    // Update ride status
                    this.activeRide.status = 'cancelled';
                    this.activeRide.cancelledAt = new Date().toISOString();
                    
                    // Save to ride history
                    const rides = JSON.parse(localStorage.getItem('landRiders_rides') || '[]');
                    rides.push(this.activeRide);
                    localStorage.setItem('landRiders_rides', JSON.stringify(rides));
                    
                    // Notify rider
                    const notifications = JSON.parse(localStorage.getItem('landRiders_notifications') || '[]');
                    const notification = {
                        id: this.generateId('NOT'),
                        riderId: this.activeRide.riderId,
                        type: 'ride_cancelled',
                        title: 'Ride Cancelled',
                        message: `${this.currentUser.name} cancelled the ride`,
                        data: this.activeRide,
                        read: false,
                        timestamp: new Date().toISOString()
                    };
                    notifications.push(notification);
                    localStorage.setItem('landRiders_notifications', JSON.stringify(notifications));
                    
                    this.activeRide = null;
                    document.getElementById('activeRideSection').style.display = 'none';
                    alert('Ride cancelled successfully');
                }
            }

            contactRider() {
                if (this.activeRide) {
                    const phone = this.activeRide.riderPhone.replace(/-/g, '');
                    if (confirm(`Call rider: ${this.activeRide.riderName}?\nPhone: ${this.activeRide.riderPhone}`)) {
                        window.location.href = `tel:${phone}`;
                    }
                }
            }

            markArrived() {
                if (this.activeRide) {
                    this.activeRide.status = 'arrived';
                    this.activeRide.arrivedAt = new Date().toISOString();
                    
                    // Update in active rides
                    const activeRides = JSON.parse(localStorage.getItem('landRiders_activeRides') || '[]');
                    const index = activeRides.findIndex(ride => ride.id === this.activeRide.id);
                    if (index !== -1) {
                        activeRides[index].status = 'arrived';
                        activeRides[index].arrivedAt = this.activeRide.arrivedAt;
                        localStorage.setItem('landRiders_activeRides', JSON.stringify(activeRides));
                    }
                    
                    // Notify customer
                    const notifications = JSON.parse(localStorage.getItem('landRiders_notifications') || '[]');
                    const notification = {
                        id: this.generateId('NOT'),
                        customerId: this.activeRide.customerId,
                        type: 'ride_arrived',
                        title: 'Rider Arrived',
                        message: `${this.activeRide.riderName} has arrived at your pickup location`,
                        data: this.activeRide,
                        read: false,
                        timestamp: new Date().toISOString()
                    };
                    notifications.push(notification);
                    localStorage.setItem('landRiders_notifications', JSON.stringify(notifications));
                    
                    alert('Arrival marked successfully! Customer has been notified.');
                }
            }

            completeRide() {
                if (this.activeRide) {
                    if (confirm('Mark this ride as completed?')) {
                        const rides = JSON.parse(localStorage.getItem('landRiders_rides') || '[]');
                        this.activeRide.status = 'completed';
                        this.activeRide.completedAt = new Date().toISOString();
                        
                        rides.push(this.activeRide);
                        localStorage.setItem('landRiders_rides', JSON.stringify(rides));

                        // Remove from active rides
                        const activeRides = JSON.parse(localStorage.getItem('landRiders_activeRides') || '[]');
                        const updatedRides = activeRides.filter(ride => ride.id !== this.activeRide.id);
                        localStorage.setItem('landRiders_activeRides', JSON.stringify(updatedRides));

                        // Update rider stats
                        const riders = JSON.parse(localStorage.getItem('landRiders_riders'));
                        const riderIndex = riders.findIndex(r => r.id === this.activeRide.riderId);
                        if (riderIndex !== -1) {
                            riders[riderIndex].totalRides = (riders[riderIndex].totalRides || 0) + 1;
                            riders[riderIndex].earnings = (riders[riderIndex].earnings || 0) + parseFloat(this.activeRide.fare);
                            
                            // Add to ride history
                            riders[riderIndex].rideHistory = riders[riderIndex].rideHistory || [];
                            riders[riderIndex].rideHistory.push({
                                rideId: this.activeRide.id,
                                customerName: this.activeRide.customerName,
                                fare: this.activeRide.fare,
                                date: this.activeRide.completedAt
                            });
                            
                            localStorage.setItem('landRiders_riders', JSON.stringify(riders));
                        }

                        // Update customer stats
                        const customers = JSON.parse(localStorage.getItem('landRiders_customers'));
                        const customerIndex = customers.findIndex(c => c.id === this.activeRide.customerId);
                        if (customerIndex !== -1) {
                            customers[customerIndex].totalRides = (customers[customerIndex].totalRides || 0) + 1;
                            customers[customerIndex].rideHistory = customers[customerIndex].rideHistory || [];
                            customers[customerIndex].rideHistory.push({
                                rideId: this.activeRide.id,
                                riderName: this.activeRide.riderName,
                                fare: this.activeRide.fare,
                                date: this.activeRide.completedAt
                            });
                            localStorage.setItem('landRiders_customers', JSON.stringify(customers));
                        }

                        // Update system stats
                        this.updateSystemStats();

                        // Notify customer
                        const notifications = JSON.parse(localStorage.getItem('landRiders_notifications') || '[]');
                        const notification = {
                            id: this.generateId('NOT'),
                            customerId: this.activeRide.customerId,
                            type: 'ride_completed',
                            title: 'Ride Completed',
                            message: `Your ride with ${this.activeRide.riderName} has been completed`,
                            data: this.activeRide,
                            read: false,
                            timestamp: new Date().toISOString()
                        };
                        notifications.push(notification);
                        localStorage.setItem('landRiders_notifications', JSON.stringify(notifications));

                        document.getElementById('activeRideSectionRider').style.display = 'none';
                        
                        // Ask for rating
                        setTimeout(() => {
                            document.getElementById('ratingModal').style.display = 'flex';
                        }, 1000);
                    }
                }
            }

            submitRating() {
                const rating = parseInt(document.getElementById('rideRatingValue').value);
                const comments = document.getElementById('rideComments').value.trim();

                if (rating === 0) {
                    alert('Please rate your ride experience');
                    return;
                }

                // Update ride with rating
                const rides = JSON.parse(localStorage.getItem('landRiders_rides') || '[]');
                const rideIndex = rides.findIndex(r => r.id === this.activeRide.id);
                if (rideIndex !== -1) {
                    rides[rideIndex].rating = rating;
                    rides[rideIndex].comments = comments;
                    localStorage.setItem('landRiders_rides', JSON.stringify(rides));
                    
                    // Update rider's average rating
                    const riders = JSON.parse(localStorage.getItem('landRiders_riders'));
                    const riderIndex = riders.findIndex(r => r.id === this.activeRide.riderId);
                    if (riderIndex !== -1) {
                        const riderRides = rides.filter(r => r.riderId === this.activeRide.riderId && r.rating);
                        if (riderRides.length > 0) {
                            const averageRating = riderRides.reduce((sum, ride) => sum + ride.rating, 0) / riderRides.length;
                            riders[riderIndex].rating = parseFloat(averageRating.toFixed(1));
                            localStorage.setItem('landRiders_riders', JSON.stringify(riders));
                        }
                    }
                }

                alert(`Thank you for your ${rating}-star rating!`);
                this.closeModal('ratingModal');
                this.activeRide = null;
                
                // Update rider stats
                if (this.currentRole === 'rider') {
                    this.updateRiderStats();
                }
            }

            updateRealTimeData() {
                if (this.currentRole === 'customer') {
                    this.updateCustomerMap();
                    this.loadNotifications();
                    
                    // Check for new offers
                    const notifications = JSON.parse(localStorage.getItem('landRiders_notifications') || '[]');
                    const newOffers = notifications.filter(n => 
                        n.type === 'ride_offer' && 
                        n.data.customerId === this.currentUser.id &&
                        !n.read
                    );

                    if (newOffers.length > 0) {
                        this.loadRideOffers();
                    }
                    
                    this.checkActiveRide();
                } else if (this.currentRole === 'rider') {
                    this.loadRiderNotifications();
                    if (this.isRiderOnline) {
                        this.loadRideRequests();
                    }
                    this.checkRiderActiveRide();
                    this.updateRiderStats();
                } else if (this.currentRole === 'admin') {
                    this.updateAdminDashboard();
                }
            }

            switchRiderTab(tab) {
                // Update active tab
                document.querySelectorAll('#riderTabs .tab-btn').forEach(t => t.classList.remove('active'));
                document.querySelector(`#riderTabs .tab-btn[data-tab="${tab}"]`).classList.add('active');

                // Show appropriate content
                document.querySelectorAll('#riderDashboard .tab-content').forEach(content => {
                    content.style.display = 'none';
                });
                document.getElementById(`${tab}Tab`).style.display = 'block';
            }

            switchAdminTab(tab) {
                // Update active tab
                document.querySelectorAll('#adminTabs .tab-btn').forEach(t => t.classList.remove('active'));
                document.querySelector(`#adminTabs .tab-btn[data-tab="${tab}"]`).classList.add('active');

                // Show appropriate content
                document.querySelectorAll('#adminDashboard .tab-content').forEach(content => {
                    content.style.display = 'none';
                });
                document.getElementById(`${tab}Tab`).style.display = 'block';
                
                // Load tab-specific data
                if (tab === 'overview') {
                    this.updateAdminDashboard();
                } else if (tab === 'riders') {
                    this.loadRidersTable();
                } else if (tab === 'customers') {
                    this.loadCustomersTable();
                } else if (tab === 'rides') {
                    this.loadRidesTable();
                } else if (tab === 'complaints') {
                    this.loadComplaintsData();
                } else if (tab === 'settings') {
                    this.loadSettings();
                }
            }

            updateAdminDashboard() {
                const rides = JSON.parse(localStorage.getItem('landRiders_rides') || '[]');
                const customers = JSON.parse(localStorage.getItem('landRiders_customers') || '[]');
                const riders = JSON.parse(localStorage.getItem('landRiders_riders') || []);
                const activeRiders = JSON.parse(localStorage.getItem('landRiders_activeRiders') || []);
                const complaints = JSON.parse(localStorage.getItem('landRiders_complaints') || []);
                
                const today = new Date().toDateString();
                const todayRides = rides.filter(ride => new Date(ride.timestamp).toDateString() === today);
                const completedRides = todayRides.filter(ride => ride.status === 'completed');
                const pendingComplaints = complaints.filter(c => c.status === 'pending');
                
                // Update stats
                document.getElementById('totalRides').textContent = completedRides.length;
                document.getElementById('activeRiders').textContent = activeRiders.length;
                document.getElementById('totalCustomers').textContent = customers.length;
                document.getElementById('pendingComplaints').textContent = pendingComplaints.length;
                
                const totalRevenue = completedRides.reduce((total, ride) => total + (parseFloat(ride.fare) || 0), 0);
                document.getElementById('totalRevenue').textContent = `Rs. ${totalRevenue}`;
                
                const totalEarnings = rides.filter(r => r.status === 'completed')
                    .reduce((total, ride) => total + (parseFloat(ride.fare) || 0), 0);
                document.getElementById('totalEarnings').textContent = `Rs. ${totalEarnings}`;

                // Load recent activity
                this.loadRecentActivity();
                
                // Load top riders and customers
                this.loadTopRiders();
                this.loadTopCustomers();
            }

            loadRidersTable() {
                const riders = JSON.parse(localStorage.getItem('landRiders_riders') || []);
                const activeRiders = JSON.parse(localStorage.getItem('landRiders_activeRiders') || []);
                
                const ridersTable = document.getElementById('ridersTable');
                ridersTable.innerHTML = '';
                
                riders.forEach(rider => {
                    const isActive = activeRiders.find(r => r.id === rider.id);
                    const earnings = rider.earnings || 0;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${rider.id}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 30px; height: 30px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                                    ${rider.name.charAt(0).toUpperCase()}
                                </div>
                                ${rider.name}
                            </div>
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${rider.phone}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">
                            <div class="rating-stars">
                                <i class="fas fa-star"></i>
                                <span class="rating-value">${rider.rating ? rider.rating.toFixed(1) : '0.0'}</span>
                            </div>
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${rider.totalRides || 0}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">Rs. ${earnings}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">
                            <span class="status-indicator ${isActive ? 'status-online' : 'status-offline'}">
                                ${isActive ? 'Online' : 'Offline'}
                            </span>
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">
                            <div style="display: flex; gap: 5px;">
                                <button class="btn" style="padding: 5px 10px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer;"
                                    onclick="app.viewRiderDetails('${rider.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn" style="padding: 5px 10px; background: var(--danger); color: white; border: none; border-radius: 5px; cursor: pointer;"
                                    onclick="app.deleteRider('${rider.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    ridersTable.appendChild(row);
                });
            }

            loadCustomersTable() {
                const customers = JSON.parse(localStorage.getItem('landRiders_customers') || []);
                
                const customersTable = document.getElementById('customersTable');
                customersTable.innerHTML = '';
                
                customers.forEach(customer => {
                    const joinDate = new Date(customer.createdAt);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${customer.id.substring(0, 8)}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 30px; height: 30px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                                    ${customer.name.charAt(0).toUpperCase()}
                                </div>
                                ${customer.name}
                            </div>
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${customer.phone}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${customer.email || 'N/A'}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${customer.totalRides || 0}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">
                            <div class="rating-stars">
                                <i class="fas fa-star"></i>
                                <span class="rating-value">${customer.rating ? customer.rating.toFixed(1) : '0.0'}</span>
                            </div>
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${joinDate.toLocaleDateString()}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">
                            <div style="display: flex; gap: 5px;">
                                <button class="btn" style="padding: 5px 10px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer;"
                                    onclick="app.viewCustomerDetails('${customer.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    customersTable.appendChild(row);
                });
            }

            loadRidesTable() {
                const rides = JSON.parse(localStorage.getItem('landRiders_rides') || []);
                const filteredRides = this.filterRidesByPeriod(rides, 'today');
                
                this.displayRidesTable(filteredRides);
            }

            filterRides(period) {
                const rides = JSON.parse(localStorage.getItem('landRiders_rides') || []);
                const filteredRides = this.filterRidesByPeriod(rides, period);
                
                // Update active filter button
                document.querySelectorAll('#ridesTab .filter-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById(`filter${period.charAt(0).toUpperCase() + period.slice(1)}Btn`).classList.add('active');
                
                this.displayRidesTable(filteredRides);
            }

            filterRidesByPeriod(rides, period) {
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const weekAgo = new Date(today);
                weekAgo.setDate(weekAgo.getDate() - 7);
                const monthAgo = new Date(today);
                monthAgo.setMonth(monthAgo.getMonth() - 1);
                
                switch(period) {
                    case 'today':
                        return rides.filter(ride => new Date(ride.timestamp) >= today);
                    case 'week':
                        return rides.filter(ride => new Date(ride.timestamp) >= weekAgo);
                    case 'month':
                        return rides.filter(ride => new Date(ride.timestamp) >= monthAgo);
                    default:
                        return rides;
                }
            }

            displayRidesTable(rides) {
                const ridesTable = document.getElementById('ridesTable');
                ridesTable.innerHTML = '';
                
                rides.forEach(ride => {
                    const rideDate = new Date(ride.timestamp);
                    const statusClass = ride.status === 'completed' ? 'status-completed' : 
                                      ride.status === 'cancelled' ? 'status-cancelled' : 'status-pending';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${ride.id.substring(0, 8)}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${ride.customerName}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${ride.riderName}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${ride.pickup}  ${ride.destination}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">Rs. ${ride.fare}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${rideDate.toLocaleDateString()}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">
                            <span class="status-indicator ${statusClass}">${ride.status}</span>
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">
                            ${ride.rating ? `${ride.rating}/5` : 'Not rated'}
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">
                            <button class="btn" style="padding: 5px 10px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer;"
                                onclick="app.viewRideDetails('${ride.id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    `;
                    ridesTable.appendChild(row);
                });
            }

            loadComplaintsData() {
                const complaints = JSON.parse(localStorage.getItem('landRiders_complaints') || []);
                const pendingComplaints = complaints.filter(c => c.status === 'pending');
                const resolvedComplaints = complaints.filter(c => c.status === 'resolved');
                
                // Update summary
                const summaryHtml = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div class="dashboard-card">
                            <h4>Pending Complaints</h4>
                            <div style="font-size: 36px; color: var(--warning); font-weight: bold;">${pendingComplaints.length}</div>
                        </div>
                        <div class="dashboard-card">
                            <h4>Resolved Complaints</h4>
                            <div style="font-size: 36px; color: var(--success); font-weight: bold;">${resolvedComplaints.length}</div>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <h4>Average Rating from Complaints</h4>
                        <div style="font-size: 24px; color: var(--primary); font-weight: bold;">
                            ${complaints.length > 0 ? (complaints.reduce((sum, c) => sum + (c.rating || 0), 0) / complaints.length).toFixed(1) : '0.0'}/5
                        </div>
                    </div>
                `;
                document.getElementById('complaintsSummary').innerHTML = summaryHtml;
                
                // Load recent complaints
                this.loadRecentComplaints(complaints.slice(0, 10));
            }

            loadRecentComplaints(complaints) {
                const recentComplaintsDiv = document.getElementById('recentComplaints');
                recentComplaintsDiv.innerHTML = '';
                
                if (complaints.length === 0) {
                    recentComplaintsDiv.innerHTML = '<p style="text-align: center; color: var(--gray); padding: 20px;">No complaints yet.</p>';
                    return;
                }
                
                complaints.forEach(complaint => {
                    const complaintCard = document.createElement('div');
                    complaintCard.className = 'dashboard-card';
                    complaintCard.style.marginBottom = '10px';
                    
                    const complaintDate = new Date(complaint.timestamp);
                    const statusClass = complaint.status === 'pending' ? 'status-pending' : 'status-completed';
                    
                    complaintCard.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <div>
                                <h4 style="color: var(--primary); margin-bottom: 5px;">${complaint.customerName}</h4>
                                <p style="color: var(--gray); font-size: 12px;">vs ${complaint.riderName} (${complaint.riderId})</p>
                            </div>
                            <span class="status-indicator ${statusClass}">${complaint.status}</span>
                        </div>
                        <p style="margin-bottom: 10px;">${complaint.details}</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div class="rating-stars">
                                ${''.repeat(complaint.rating)}${''.repeat(5-complaint.rating)}
                                <span class="rating-value">${complaint.rating}/5</span>
                            </div>
                            <span style="color: var(--gray); font-size: 12px;">${complaintDate.toLocaleDateString()}</span>
                        </div>
                    `;
                    
                    recentComplaintsDiv.appendChild(complaintCard);
                });
            }

            loadRecentActivity() {
                const rides = JSON.parse(localStorage.getItem('landRiders_rides') || []);
                const complaints = JSON.parse(localStorage.getItem('landRiders_complaints') || []);
                const notifications = JSON.parse(localStorage.getItem('landRiders_notifications') || []);
                
                // Combine all activities
                const activities = [];
                
                // Add rides
                rides.slice(-10).forEach(ride => {
                    activities.push({
                        type: 'ride',
                        title: `${ride.customerName}  ${ride.riderName}`,
                        description: `${ride.pickup} to ${ride.destination}`,
                        time: new Date(ride.timestamp),
                        status: ride.status
                    });
                });
                
                // Add complaints
                complaints.slice(-5).forEach(complaint => {
                    activities.push({
                        type: 'complaint',
                        title: `Complaint from ${complaint.customerName}`,
                        description: `Against ${complaint.riderName}`,
                        time: new Date(complaint.timestamp),
                        status: complaint.status
                    });
                });
                
                // Sort by time
                activities.sort((a, b) => b.time - a.time);
                
                // Display
                const recentActivityDiv = document.getElementById('recentActivity');
                recentActivityDiv.innerHTML = '';
                
                activities.slice(0, 10).forEach(activity => {
                    const activityItem = document.createElement('div');
                    activityItem.style.cssText = `
                        padding: 10px;
                        border-bottom: 1px solid var(--light-gray);
                        display: flex;
                        align-items: center;
                        gap: 10px;
                    `;
                    
                    const icon = activity.type === 'ride' ? 'fa-car' : 'fa-exclamation-triangle';
                    const iconColor = activity.type === 'ride' ? 'var(--primary)' : 'var(--warning)';
                    
                    activityItem.innerHTML = `
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: ${iconColor}; color: white; display: flex; align-items: center; justify-content: center;">
                            <i class="fas ${icon}"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600;">${activity.title}</div>
                            <div style="color: var(--gray); font-size: 12px;">${activity.description}</div>
                            <div style="color: var(--gray); font-size: 10px;">${activity.time.toLocaleString()}</div>
                        </div>
                        <span class="status-indicator ${activity.status === 'completed' ? 'status-completed' : 'status-pending'}">
                            ${activity.status}
                        </span>
                    `;
                    
                    recentActivityDiv.appendChild(activityItem);
                });
            }

            loadTopRiders() {
                const riders = JSON.parse(localStorage.getItem('landRiders_riders') || []);
                const topRiders = [...riders]
                    .sort((a, b) => (b.rating || 0) - (a.rating || 0))
                    .slice(0, 5);
                
                const topRidersDiv = document.getElementById('topRiders');
                topRidersDiv.innerHTML = '';
                
                topRiders.forEach((rider, index) => {
                    const riderItem = document.createElement('div');
                    riderItem.style.cssText = `
                        padding: 10px;
                        border-bottom: 1px solid var(--light-gray);
                        display: flex;
                        align-items: center;
                        gap: 10px;
                    `;
                    
                    riderItem.innerHTML = `
                        <div style="width: 30px; height: 30px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                            ${index + 1}
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600;">${rider.name}</div>
                            <div style="color: var(--gray); font-size: 12px;">ID: ${rider.id} | Rides: ${rider.totalRides || 0}</div>
                        </div>
                        <div class="rating-stars">
                            <i class="fas fa-star"></i>
                            <span class="rating-value">${rider.rating ? rider.rating.toFixed(1) : '0.0'}</span>
                        </div>
                    `;
                    
                    topRidersDiv.appendChild(riderItem);
                });
            }

            loadTopCustomers() {
                const customers = JSON.parse(localStorage.getItem('landRiders_customers') || []);
                const topCustomers = [...customers]
                    .sort((a, b) => (b.totalRides || 0) - (a.totalRides || 0))
                    .slice(0, 5);
                
                const topCustomersDiv = document.getElementById('topCustomers');
                topCustomersDiv.innerHTML = '';
                
                topCustomers.forEach((customer, index) => {
                    const customerItem = document.createElement('div');
                    customerItem.style.cssText = `
                        padding: 10px;
                        border-bottom: 1px solid var(--light-gray);
                        display: flex;
                        align-items: center;
                        gap: 10px;
                    `;
                    
                    customerItem.innerHTML = `
                        <div style="width: 30px; height: 30px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                            ${index + 1}
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600;">${customer.name}</div>
                            <div style="color: var(--gray); font-size: 12px;">Phone: ${customer.phone}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: bold; color: var(--primary);">${customer.totalRides || 0}</div>
                            <div style="color: var(--gray); font-size: 12px;">Rides</div>
                        </div>
                    `;
                    
                    topCustomersDiv.appendChild(customerItem);
                });
            }

            loadSystemInfo() {
                const customers = JSON.parse(localStorage.getItem('landRiders_customers') || []);
                const riders = JSON.parse(localStorage.getItem('landRiders_riders') || []);
                const rides = JSON.parse(localStorage.getItem('landRiders_rides') || []);
                const complaints = JSON.parse(localStorage.getItem('landRiders_complaints') || []);
                
                const totalRevenue = rides.filter(r => r.status === 'completed')
                    .reduce((total, ride) => total + (parseFloat(ride.fare) || 0), 0);
                
                const avgRating = rides.filter(r => r.rating)
                    .reduce((sum, ride) => sum + ride.rating, 0) / rides.filter(r => r.rating).length || 0;
                
                const systemInfoHtml = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div><strong>Total Customers:</strong> ${customers.length}</div>
                        <div><strong>Total Riders:</strong> ${riders.length}</div>
                        <div><strong>Total Rides:</strong> ${rides.filter(r => r.status === 'completed').length}</div>
                        <div><strong>Total Revenue:</strong> Rs. ${totalRevenue}</div>
                        <div><strong>Average Rating:</strong> ${avgRating.toFixed(1)}/5</div>
                        <div><strong>Total Complaints:</strong> ${complaints.length}</div>
                        <div><strong>Pending Complaints:</strong> ${complaints.filter(c => c.status === 'pending').length}</div>
                        <div><strong>Resolved Complaints:</strong> ${complaints.filter(c => c.status === 'resolved').length}</div>
                    </div>
                `;
                
                document.getElementById('systemInfo').innerHTML = systemInfoHtml;
            }

            loadSettings() {
                const settings = JSON.parse(localStorage.getItem('landRiders_settings'));
                
                if (settings) {
                    document.getElementById('baseFareBike').value = settings.baseFareBike || 50;
                    document.getElementById('baseFareCar').value = settings.baseFareCar || 200;
                    document.getElementById('perKmBike').value = settings.perKmBike || 20;
                    document.getElementById('perKmCar').value = settings.perKmCar || 50;
                    document.getElementById('minFare').value = settings.minFare || 50;
                }
            }

            saveSettings() {
                const settings = {
                    baseFareBike: parseFloat(document.getElementById('baseFareBike').value) || 50,
                    baseFareCar: parseFloat(document.getElementById('baseFareCar').value) || 200,
                    perKmBike: parseFloat(document.getElementById('perKmBike').value) || 20,
                    perKmCar: parseFloat(document.getElementById('perKmCar').value) || 50,
                    minFare: parseFloat(document.getElementById('minFare').value) || 50,
                    commissionRate: 0.1
                };
                
                localStorage.setItem('landRiders_settings', JSON.stringify(settings));
                alert('Settings saved successfully!');
            }

            exportRidersData() {
                const riders = JSON.parse(localStorage.getItem('landRiders_riders') || []);
                const csvContent = this.convertToCSV(riders);
                
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'land_riders_data.csv';
                a.click();
                
                alert('Riders data exported successfully!');
            }

            convertToCSV(data) {
                const headers = ['ID', 'Name', 'Phone', 'Email', 'Total Rides', 'Rating', 'Earnings', 'Status', 'Join Date'];
                const rows = data.map(rider => [
                    rider.id,
                    rider.name,
                    rider.phone,
                    rider.email || '',
                    rider.totalRides || 0,
                    rider.rating || 0,
                    rider.earnings || 0,
                    rider.status || 'active',
                    new Date(rider.joinDate).toLocaleDateString()
                ]);
                
                return [headers, ...rows].map(row => row.join(',')).join('\n');
            }

            searchRiders(query) {
                const riders = JSON.parse(localStorage.getItem('landRiders_riders') || []);
                const filteredRiders = riders.filter(rider => 
                    rider.name.toLowerCase().includes(query.toLowerCase()) ||
                    rider.id.includes(query) ||
                    rider.phone.includes(query)
                );
                
                this.displayFilteredRiders(filteredRiders);
            }

            displayFilteredRiders(riders) {
                const ridersTable = document.getElementById('ridersTable');
                ridersTable.innerHTML = '';
                
                riders.forEach(rider => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${rider.id}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${rider.name}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${rider.phone}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">
                            <div class="rating-stars">
                                <i class="fas fa-star"></i>
                                <span class="rating-value">${rider.rating ? rider.rating.toFixed(1) : '0.0'}</span>
                            </div>
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${rider.totalRides || 0}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">Rs. ${rider.earnings || 0}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">
                            <span class="status-indicator ${rider.isOnline ? 'status-online' : 'status-offline'}">
                                ${rider.isOnline ? 'Online' : 'Offline'}
                            </span>
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">
                            <div style="display: flex; gap: 5px;">
                                <button class="btn" style="padding: 5px 10px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer;"
                                    onclick="app.viewRiderDetails('${rider.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn" style="padding: 5px 10px; background: var(--danger); color: white; border: none; border-radius: 5px; cursor: pointer;"
                                    onclick="app.deleteRider('${rider.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    ridersTable.appendChild(row);
                });
            }

            searchCustomers(query) {
                const customers = JSON.parse(localStorage.getItem('landRiders_customers') || []);
                const filteredCustomers = customers.filter(customer => 
                    customer.name.toLowerCase().includes(query.toLowerCase()) ||
                    customer.phone.includes(query) ||
                    (customer.email && customer.email.toLowerCase().includes(query.toLowerCase()))
                );
                
                this.displayFilteredCustomers(filteredCustomers);
            }

            displayFilteredCustomers(customers) {
                const customersTable = document.getElementById('customersTable');
                customersTable.innerHTML = '';
                
                customers.forEach(customer => {
                    const joinDate = new Date(customer.createdAt);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${customer.id.substring(0, 8)}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${customer.name}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${customer.phone}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${customer.email || 'N/A'}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${customer.totalRides || 0}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">
                            <div class="rating-stars">
                                <i class="fas fa-star"></i>
                                <span class="rating-value">${customer.rating ? customer.rating.toFixed(1) : '0.0'}</span>
                            </div>
                        </td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">${joinDate.toLocaleDateString()}</td>
                        <td style="padding: 10px; border-bottom: 1px solid var(--light-gray);">
                            <div style="display: flex; gap: 5px;">
                                <button class="btn" style="padding: 5px 10px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer;"
                                    onclick="app.viewCustomerDetails('${customer.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    customersTable.appendChild(row);
                });
            }

            searchRides(query) {
                const rides = JSON.parse(localStorage.getItem('landRiders_rides') || []);
                const filteredRides = rides.filter(ride => 
                    ride.customerName.toLowerCase().includes(query.toLowerCase()) ||
                    ride.riderName.toLowerCase().includes(query.toLowerCase()) ||
                    ride.pickup.toLowerCase().includes(query.toLowerCase()) ||
                    ride.destination.toLowerCase().includes(query.toLowerCase()) ||
                    ride.id.includes(query)
                );
                
                this.displayRidesTable(filteredRides);
            }

            searchComplaints(query) {
                const complaints = JSON.parse(localStorage.getItem('landRiders_complaints') || []);
                const filteredComplaints = complaints.filter(complaint => 
                    complaint.customerName.toLowerCase().includes(query.toLowerCase()) ||
                    complaint.riderName.toLowerCase().includes(query.toLowerCase()) ||
                    complaint.details.toLowerCase().includes(query.toLowerCase())
                );
                
                this.loadRecentComplaints(filteredComplaints.slice(0, 10));
            }

            searchRiderHistory(query) {
                const rides = JSON.parse(localStorage.getItem('landRiders_rides') || []);
                const riderRides = rides.filter(ride => 
                    ride.riderId === this.currentUser.id &&
                    (ride.customerName.toLowerCase().includes(query.toLowerCase()) ||
                     ride.pickup.toLowerCase().includes(query.toLowerCase()) ||
                     ride.destination.toLowerCase().includes(query.toLowerCase()))
                );
                
                this.displayRiderHistory(riderRides);
            }

            displayRiderHistory(rides) {
                const historyList = document.getElementById('riderHistoryList');
                historyList.innerHTML = '';

                if (rides.length === 0) {
                    historyList.innerHTML = '<p style="text-align: center; color: var(--gray); padding: 20px;">No matching rides found.</p>';
                    return;
                }

                rides.forEach(ride => {
                    const historyCard = document.createElement('div');
                    historyCard.className = 'ride-request-card';
                    
                    const statusClass = ride.status === 'completed' ? 'status-completed' : 
                                      ride.status === 'cancelled' ? 'status-cancelled' : 'status-pending';
                    
                    historyCard.innerHTML = `
                        <div class="ride-request-header">
                            <div>
                                <h4 style="color: var(--primary); margin-bottom: 5px;">${ride.customerName}</h4>
                                <p style="color: var(--gray); font-size: 12px;">${new Date(ride.timestamp).toLocaleDateString()}</p>
                            </div>
                            <span class="status-indicator ${statusClass}">${ride.status}</span>
                        </div>
                        <div class="ride-request-info">
                            <p><i class="fas fa-map-marker-alt"></i> <strong>From:</strong> ${ride.pickup}</p>
                            <p><i class="fas fa-flag-checkered"></i> <strong>To:</strong> ${ride.destination}</p>
                            <p><i class="fas fa-money-bill-wave"></i> <strong>Fare:</strong> Rs. ${ride.fare}</p>
                            ${ride.rating ? `<p><i class="fas fa-star"></i> <strong>Rating:</strong> ${ride.rating}/5</p>` : ''}
                        </div>
                        <button class="btn btn-secondary" onclick="app.viewRideDetails('${ride.id}')" style="width: 100%;">
                            <i class="fas fa-eye"></i> View Details
                        </button>
                    `;
                    
                    historyList.appendChild(historyCard);
                });
            }

            viewRiderDetails(riderId) {
                const riders = JSON.parse(localStorage.getItem('landRiders_riders'));
                const rider = riders.find(r => r.id === riderId);
                
                if (rider) {
                    const detailsHtml = `
                        <div class="dashboard-card">
                            <h3>Rider Details</h3>
                            <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                                <div style="width: 80px; height: 80px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: bold;">
                                    ${rider.name.charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <h2 style="color: var(--primary);">${rider.name}</h2>
                                    <p style="color: var(--gray);">ID: ${rider.id}</p>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                                <div>
                                    <strong>Phone:</strong><br>
                                    ${rider.phone}
                                </div>
                                <div>
                                    <strong>Email:</strong><br>
                                    ${rider.email || 'N/A'}
                                </div>
                                <div>
                                    <strong>Total Rides:</strong><br>
                                    ${rider.totalRides || 0}
                                </div>
                                <div>
                                    <strong>Rating:</strong><br>
                                    <div class="rating-stars">
                                        <i class="fas fa-star"></i>
                                        <span class="rating-value">${rider.rating ? rider.rating.toFixed(1) : '0.0'}</span>
                                    </div>
                                </div>
                                <div>
                                    <strong>Earnings:</strong><br>
                                    Rs. ${rider.earnings || 0}
                                </div>
                                <div>
                                    <strong>Status:</strong><br>
                                    <span class="status-indicator ${rider.status === 'active' ? 'status-online' : 'status-offline'}">
                                        ${rider.status}
                                    </span>
                                </div>
                                <div>
                                    <strong>Vehicle:</strong><br>
                                    ${rider.vehicle || 'Bike'}
                                </div>
                                <div>
                                    <strong>Joined:</strong><br>
                                    ${new Date(rider.joinDate).toLocaleDateString()}
                                </div>
                            </div>
                            ${rider.badges && rider.badges.length > 0 ? `
                                <div>
                                    <strong>Badges:</strong><br>
                                    <div style="display: flex; gap: 5px; margin-top: 5px;">
                                        ${rider.badges.map(badge => `<span style="background: var(--secondary); color: var(--dark); padding: 3px 8px; border-radius: 12px; font-size: 12px;">${badge}</span>`).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    `;
                    
                    document.getElementById('rideDetailsContent').innerHTML = detailsHtml;
                    document.getElementById('rideDetailsModal').style.display = 'flex';
                }
            }

            viewCustomerDetails(customerId) {
                const customers = JSON.parse(localStorage.getItem('landRiders_customers'));
                const customer = customers.find(c => c.id === customerId);
                
                if (customer) {
                    const detailsHtml = `
                        <div class="dashboard-card">
                            <h3>Customer Details</h3>
                            <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                                <div style="width: 80px; height: 80px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: bold;">
                                    ${customer.name.charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <h2 style="color: var(--primary);">${customer.name}</h2>
                                    <p style="color: var(--gray);">ID: ${customer.id.substring(0, 8)}</p>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                                <div>
                                    <strong>Phone:</strong><br>
                                    ${customer.phone}
                                </div>
                                <div>
                                    <strong>Email:</strong><br>
                                    ${customer.email || 'N/A'}
                                </div>
                                <div>
                                    <strong>Total Rides:</strong><br>
                                    ${customer.totalRides || 0}
                                </div>
                                <div>
                                    <strong>Rating:</strong><br>
                                    <div class="rating-stars">
                                        <i class="fas fa-star"></i>
                                        <span class="rating-value">${customer.rating ? customer.rating.toFixed(1) : '0.0'}</span>
                                    </div>
                                </div>
                                <div>
                                    <strong>Complaints:</strong><br>
                                    ${customer.complaints || 0}
                                </div>
                                <div>
                                    <strong>Status:</strong><br>
                                    <span class="status-indicator status-online">
                                        Active
                                    </span>
                                </div>
                                <div>
                                    <strong>Joined:</strong><br>
                                    ${new Date(customer.createdAt).toLocaleDateString()}
                                </div>
                            </div>
                        </div>
                    `;
                    
                    document.getElementById('rideDetailsContent').innerHTML = detailsHtml;
                    document.getElementById('rideDetailsModal').style.display = 'flex';
                }
            }

            viewRideDetails(rideId) {
                const rides = JSON.parse(localStorage.getItem('landRiders_rides'));
                const ride = rides.find(r => r.id === rideId);
                
                if (ride) {
                    const rideDate = new Date(ride.timestamp);
                    const statusClass = ride.status === 'completed' ? 'status-completed' : 
                                      ride.status === 'cancelled' ? 'status-cancelled' : 'status-pending';
                    
                    const detailsHtml = `
                        <div class="dashboard-card">
                            <h3>Ride Details</h3>
                            <div style="margin-bottom: 20px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <div>
                                        <strong>Ride ID:</strong> ${ride.id.substring(0, 8)}
                                    </div>
                                    <span class="status-indicator ${statusClass}">${ride.status}</span>
                                </div>
                                <div style="color: var(--gray); font-size: 12px;">
                                    ${rideDate.toLocaleString()}
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                <div class="dashboard-card">
                                    <h4>Customer</h4>
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                        <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                                            ${ride.customerName.charAt(0).toUpperCase()}
                                        </div>
                                        <div>
                                            <div style="font-weight: 600;">${ride.customerName}</div>
                                            <div style="color: var(--gray); font-size: 12px;">${ride.customerPhone}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="dashboard-card">
                                    <h4>Rider</h4>
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                        <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--accent); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                                            ${ride.riderName.charAt(0).toUpperCase()}
                                        </div>
                                        <div>
                                            <div style="font-weight: 600;">${ride.riderName}</div>
                                            <div style="color: var(--gray); font-size: 12px;">${ride.riderPhone}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="dashboard-card">
                                <h4>Route Details</h4>
                                <div style="margin-bottom: 10px;">
                                    <strong>Pickup:</strong> ${ride.pickup}
                                </div>
                                <div style="margin-bottom: 10px;">
                                    <strong>Destination:</strong> ${ride.destination}
                                </div>
                                <div style="margin-bottom: 10px;">
                                    <strong>Vehicle:</strong> ${ride.vehicle}
                                </div>
                                <div style="margin-bottom: 10px;">
                                    <strong>Fare:</strong> Rs. ${ride.fare}
                                </div>
                                ${ride.estimatedTime ? `<div style="margin-bottom: 10px;"><strong>Estimated Time:</strong> ${ride.estimatedTime} minutes</div>` : ''}
                                ${ride.rating ? `
                                    <div style="margin-bottom: 10px;">
                                        <strong>Rating:</strong> 
                                        <div class="rating-stars">
                                            ${''.repeat(ride.rating)}${''.repeat(5-ride.rating)}
                                            <span class="rating-value">${ride.rating}/5</span>
                                        </div>
                                    </div>
                                ` : ''}
                                ${ride.comments ? `<div><strong>Comments:</strong> ${ride.comments}</div>` : ''}
                            </div>
                            
                            ${ride.arrivedAt ? `
                                <div class="dashboard-card">
                                    <h4>Timeline</h4>
                                    <div style="margin-bottom: 5px;">
                                        <i class="fas fa-clock"></i> <strong>Requested:</strong> ${new Date(ride.timestamp).toLocaleTimeString()}
                                    </div>
                                    <div style="margin-bottom: 5px;">
                                        <i class="fas fa-check"></i> <strong>Accepted:</strong> ${new Date(ride.acceptedAt).toLocaleTimeString()}
                                    </div>
                                    <div style="margin-bottom: 5px;">
                                        <i class="fas fa-map-marker-alt"></i> <strong>Arrived:</strong> ${new Date(ride.arrivedAt).toLocaleTimeString()}
                                    </div>
                                    ${ride.completedAt ? `
                                        <div>
                                            <i class="fas fa-flag-checkered"></i> <strong>Completed:</strong> ${new Date(ride.completedAt).toLocaleTimeString()}
                                        </div>
                                    ` : ''}
                                </div>
                            ` : ''}
                        </div>
                    `;
                    
                    document.getElementById('rideDetailsContent').innerHTML = detailsHtml;
                    document.getElementById('rideDetailsModal').style.display = 'flex';
                }
            }

            deleteRider(riderId) {
                if (confirm('Are you sure you want to delete this rider? This action cannot be undone.')) {
                    let riders = JSON.parse(localStorage.getItem('landRiders_riders') || '[]');
                    riders = riders.filter(r => r.id !== riderId);
                    localStorage.setItem('landRiders_riders', JSON.stringify(riders));
                    
                    // Remove from active riders
                    let activeRiders = JSON.parse(localStorage.getItem('landRiders_activeRiders') || '[]');
                    activeRiders = activeRiders.filter(r => r.id !== riderId);
                    localStorage.setItem('landRiders_activeRiders', JSON.stringify(activeRiders));
                    
                    // Update system stats
                    this.updateSystemStats();
                    
                    alert('Rider deleted successfully');
                    
                    // Update admin dashboard
                    this.loadRidersTable();
                }
            }

            updateSystemStats() {
                const customers = JSON.parse(localStorage.getItem('landRiders_customers') || []);
                const riders = JSON.parse(localStorage.getItem('landRiders_riders') || []);
                const rides = JSON.parse(localStorage.getItem('landRiders_rides') || []);
                const complaints = JSON.parse(localStorage.getItem('landRiders_complaints') || []);
                
                const systemStats = {
                    totalRides: rides.filter(r => r.status === 'completed').length,
                    totalRevenue: rides.filter(r => r.status === 'completed')
                        .reduce((total, ride) => total + (parseFloat(ride.fare) || 0), 0),
                    totalCustomers: customers.length,
                    totalRiders: riders.length,
                    pendingComplaints: complaints.filter(c => c.status === 'pending').length
                };
                
                localStorage.setItem('landRiders_systemStats', JSON.stringify(systemStats));
            }

            updateCustomerStats() {
                const customer = JSON.parse(localStorage.getItem('landRiders_customers'))
                    .find(c => c.id === this.currentUser.id);
                
                if (customer) {
                    document.getElementById('customerTotalRides').textContent = customer.totalRides || 0;
                    document.getElementById('customerRating').textContent = customer.rating ? customer.rating.toFixed(1) : '0.0';
                    
                    // Update rating stars
                    const ratingStars = document.querySelectorAll('#customerRating ~ .fa-star');
                    const rating = customer.rating || 0;
                    ratingStars.forEach((star, index) => {
                        if (index < Math.floor(rating)) {
                            star.style.color = '#FFD600';
                        } else if (index < rating) {
                            star.style.color = '#FFD600';
                        } else {
                            star.style.color = '#ddd';
                        }
                    });
                }
            }

            loadNotifications() {
                const notifications = JSON.parse(localStorage.getItem('landRiders_notifications') || '[]');
                let customerNotifications = [];
                
                if (this.currentRole === 'customer') {
                    customerNotifications = notifications.filter(n => 
                        (n.type === 'ride_offer' && n.data.customerId === this.currentUser.id) ||
                        (n.type === 'ride_accepted' && n.data.customerId === this.currentUser.id) ||
                        (n.type === 'ride_arrived' && n.data.customerId === this.currentUser.id) ||
                        (n.type === 'ride_completed' && n.data.customerId === this.currentUser.id) ||
                        (n.type === 'ride_cancelled' && n.data.customerId === this.currentUser.id)
                    );
                    
                    const unreadCount = customerNotifications.filter(n => !n.read).length;
                    document.getElementById('notificationCount').textContent = unreadCount;
                    document.getElementById('notificationCount').style.display = unreadCount > 0 ? 'flex' : 'none';
                } else if (this.currentRole === 'rider') {
                    customerNotifications = notifications.filter(n => 
                        n.riderId === this.currentUser.id
                    );
                    
                    const unreadCount = customerNotifications.filter(n => !n.read).length;
                    document.getElementById('riderNotificationCount').textContent = unreadCount;
                    document.getElementById('riderNotificationCount').style.display = unreadCount > 0 ? 'flex' : 'none';
                }
            }

            loadRiderNotifications() {
                this.loadNotifications();
            }

            showNotifications() {
                const notifications = JSON.parse(localStorage.getItem('landRiders_notifications') || '[]');
                let filteredNotifications = [];

                if (this.currentRole === 'customer') {
                    filteredNotifications = notifications.filter(n => 
                        (n.type === 'ride_offer' && n.data.customerId === this.currentUser.id) ||
                        (n.type === 'ride_accepted' && n.data.customerId === this.currentUser.id) ||
                        (n.type === 'ride_arrived' && n.data.customerId === this.currentUser.id) ||
                        (n.type === 'ride_completed' && n.data.customerId === this.currentUser.id) ||
                        (n.type === 'ride_cancelled' && n.data.customerId === this.currentUser.id)
                    );
                } else if (this.currentRole === 'rider') {
                    filteredNotifications = notifications.filter(n => 
                        n.riderId === this.currentUser.id
                    );
                }

                const notificationList = document.getElementById('notificationList');
                notificationList.innerHTML = '';

                if (filteredNotifications.length === 0) {
                    notificationList.innerHTML = '<p style="text-align: center; color: var(--gray); padding: 20px;">No notifications.</p>';
                } else {
                    // Sort by timestamp (newest first)
                    filteredNotifications.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    
                    filteredNotifications.forEach(notification => {
                        const notificationItem = document.createElement('div');
                        notificationItem.style.cssText = `
                            background: ${notification.read ? 'var(--light)' : 'rgba(46, 125, 50, 0.1)'};
                            border-radius: 10px;
                            padding: 15px;
                            margin-bottom: 10px;
                        `;
                        
                        let icon = 'fa-bell';
                        let iconColor = 'var(--primary)';
                        let actionText = '';
                        
                        switch(notification.type) {
                            case 'ride_offer':
                                icon = 'fa-money-bill-wave';
                                iconColor = 'var(--success)';
                                actionText = `Offered Rs. ${notification.data.fare}`;
                                break;
                            case 'ride_accepted':
                                icon = 'fa-check';
                                iconColor = 'var(--success)';
                                actionText = 'Accepted your ride';
                                break;
                            case 'ride_arrived':
                                icon = 'fa-map-marker-alt';
                                iconColor = 'var(--warning)';
                                actionText = 'Arrived at pickup location';
                                break;
                            case 'ride_completed':
                                icon = 'fa-flag-checkered';
                                iconColor = 'var(--success)';
                                actionText = 'Completed the ride';
                                break;
                            case 'ride_cancelled':
                                icon = 'fa-times';
                                iconColor = 'var(--danger)';
                                actionText = 'Cancelled the ride';
                                break;
                            case 'ride_request':
                                icon = 'fa-car';
                                iconColor = 'var(--primary)';
                                actionText = 'New ride request';
                                break;
                        }
                        
                        notificationItem.innerHTML = `
                            <div style="display: flex; align-items: start; gap: 10px;">
                                <div style="width: 40px; height: 40px; border-radius: 50%; background: ${iconColor}; color: white; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas ${icon}"></i>
                                </div>
                                <div style="flex: 1;">
                                    <h4 style="color: var(--primary); margin-bottom: 5px;">${notification.title}</h4>
                                    <p>${notification.message}</p>
                                    ${actionText ? `<p style="color: var(--success); font-weight: bold; margin-top: 5px;">${actionText}</p>` : ''}
                                    <p style="color: var(--gray); font-size: 12px; margin-top: 10px;">
                                        ${new Date(notification.timestamp).toLocaleString()}
                                    </p>
                                </div>
                            </div>
                        `;
                        
                        notificationList.appendChild(notificationItem);
                    });

                    // Mark as read
                    notifications.forEach(n => {
                        if (filteredNotifications.find(fn => fn.id === n.id)) {
                            n.read = true;
                        }
                    });
                    localStorage.setItem('landRiders_notifications', JSON.stringify(notifications));
                    
                    // Update notification counts
                    this.loadNotifications();
                }

                document.getElementById('notificationModal').style.display = 'flex';
            }

            viewComplaints() {
                const complaints = JSON.parse(localStorage.getItem('landRiders_complaints') || '[]');
                const complaintsList = document.getElementById('complaintsList');
                complaintsList.innerHTML = '';

                if (complaints.length === 0) {
                    complaintsList.innerHTML = '<p style="text-align: center; color: var(--gray); padding: 20px;">No complaints yet.</p>';
                } else {
                    complaints.forEach(complaint => {
                        const complaintCard = document.createElement('div');
                        complaintCard.style.cssText = `
                            background: var(--light-gray);
                            border-radius: 10px;
                            padding: 15px;
                            margin-bottom: 10px;
                        `;
                        
                        const complaintDate = new Date(complaint.timestamp);
                        const statusClass = complaint.status === 'pending' ? 'status-pending' : 'status-completed';
                        
                        complaintCard.innerHTML = `
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                <div>
                                    <h4 style="color: var(--primary); margin-bottom: 5px;">Complaint from: ${complaint.customerName}</h4>
                                    <p style="color: var(--gray); font-size: 12px;">vs ${complaint.riderName} (${complaint.riderId})</p>
                                </div>
                                <span class="status-indicator ${statusClass}">${complaint.status}</span>
                            </div>
                            <p><strong>Customer Phone:</strong> ${complaint.customerPhone}</p>
                            ${complaint.customerEmail ? `<p><strong>Email:</strong> ${complaint.customerEmail}</p>` : ''}
                            <p><strong>Details:</strong> ${complaint.details}</p>
                            <p><strong>Rating:</strong> ${''.repeat(complaint.rating)}${''.repeat(5-complaint.rating)} (${complaint.rating}/5)</p>
                            <p style="color: var(--gray); font-size: 12px; margin-top: 10px;">
                                ${complaintDate.toLocaleString()}
                            </p>
                            <div style="margin-top: 10px; display: flex; gap: 10px;">
                                ${complaint.status === 'pending' ? `
                                    <button class="btn btn-success" onclick="app.resolveComplaint('${complaint.id}')" style="padding: 5px 10px;">
                                        <i class="fas fa-check"></i> Resolve
                                    </button>
                                ` : ''}
                                <button class="btn btn-danger" onclick="app.deleteComplaint('${complaint.id}')" style="padding: 5px 10px;">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        `;
                        
                        complaintsList.appendChild(complaintCard);
                    });
                }

                document.getElementById('complaintsModal').style.display = 'flex';
            }

            resolveComplaint(complaintId) {
                const complaints = JSON.parse(localStorage.getItem('landRiders_complaints') || '[]');
                const complaintIndex = complaints.findIndex(c => c.id === complaintId);
                
                if (complaintIndex !== -1) {
                    complaints[complaintIndex].status = 'resolved';
                    complaints[complaintIndex].resolvedAt = new Date().toISOString();
                    complaints[complaintIndex].resolvedBy = this.currentUser.name;
                    
                    localStorage.setItem('landRiders_complaints', JSON.stringify(complaints));
                    
                    alert('Complaint marked as resolved');
                    this.viewComplaints();
                    
                    // Update admin dashboard
                    this.updateAdminDashboard();
                }
            }

            deleteComplaint(complaintId) {
                if (confirm('Are you sure you want to delete this complaint?')) {
                    let complaints = JSON.parse(localStorage.getItem('landRiders_complaints') || '[]');
                    complaints = complaints.filter(c => c.id !== complaintId);
                    localStorage.setItem('landRiders_complaints', JSON.stringify(complaints));
                    
                    alert('Complaint deleted successfully');
                    this.viewComplaints();
                    
                    // Update admin dashboard
                    this.updateAdminDashboard();
                }
            }

            requestRideFromMap(riderId) {
                const pickup = document.getElementById('pickupLocation').value.trim();
                const destination = document.getElementById('destinationLocation').value.trim();

                if (!pickup) {
                    alert('Please enter pickup location');
                    return;
                }

                if (!destination) {
                    alert('Please enter destination');
                    return;
                }

                // Calculate estimated fare
                const settings = JSON.parse(localStorage.getItem('landRiders_settings'));
                const baseFare = this.selectedVehicle === 'bike' ? settings.baseFareBike : settings.baseFareCar;
                const estimatedFare = Math.max(baseFare, settings.minFare);

                // Create ride request for specific rider
                const rideRequest = {
                    id: this.generateId('REQ'),
                    customerId: this.currentUser.id,
                    customerName: this.currentUser.name,
                    customerPhone: this.currentUser.phone,
                    customerEmail: this.currentUser.email,
                    pickup: pickup,
                    destination: destination,
                    vehicle: this.selectedVehicle,
                    estimatedFare: estimatedFare,
                    status: 'pending',
                    timestamp: new Date().toISOString(),
                    riderId: riderId,
                    offers: []
                };

                // Save ride request
                const rideRequests = JSON.parse(localStorage.getItem('landRiders_rideRequests') || '[]');
                rideRequests.push(rideRequest);
                localStorage.setItem('landRiders_rideRequests', JSON.stringify(rideRequests));

                // Notify specific rider
                const riders = JSON.parse(localStorage.getItem('landRiders_riders'));
                const rider = riders.find(r => r.id === riderId);
                
                if (rider) {
                    const notifications = JSON.parse(localStorage.getItem('landRiders_notifications') || '[]');
                    const notification = {
                        id: this.generateId('NOT'),
                        riderId: riderId,
                        type: 'ride_request',
                        title: 'Direct Ride Request',
                        message: `${this.currentUser.name} requested you directly for a ${this.selectedVehicle} ride`,
                        data: rideRequest,
                        read: false,
                        timestamp: new Date().toISOString(),
                        priority: 'high'
                    };

                    notifications.push(notification);
                    localStorage.setItem('landRiders_notifications', JSON.stringify(notifications));
                }

                alert(`Ride request sent directly to ${rider?.name || 'the rider'}`);
            }

            closeModal(modalId) {
                document.getElementById(modalId).style.display = 'none';
            }

            generateId(prefix = '') {
                const timestamp = Date.now().toString(36);
                const random = Math.random().toString(36).substr(2, 9);
                return prefix ? `${prefix}_${timestamp}_${random}` : `${timestamp}_${random}`;
            }

            detectLocation(field) {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            this.reverseGeocode([position.coords.latitude, position.coords.longitude], field);
                        },
                        (error) => {
                            console.error("Error getting location:", error);
                            alert('Unable to detect location. Please enter manually.');
                        }
                    );
                } else {
                    alert('Geolocation is not supported by your browser');
                }
            }

            reverseGeocode(coords, field) {
                // In a real app, you would use a geocoding service
                // For demo purposes, use predefined locations
                const locations = [
                    "Muzaffarabad City Center",
                    "University Road",
                    "Chakswari Road",
                    "Neelum Road",
                    "Kohala Bridge",
                    "Patika Market",
                    "Garhi Dopatta",
                    "Jalalabad Park",
                    "River View Apartments",
                    "Mall Road"
                ];
                
                const randomLocation = locations[Math.floor(Math.random() * locations.length)];
                
                if (field === 'pickup') {
                    document.getElementById('pickupLocation').value = randomLocation;
                } else {
                    document.getElementById('destinationLocation').value = randomLocation;
                }
            }
        }

        // Initialize the app
        let app;
        function initApp() {
            app = new AdvancedRideHailingApp();
            window.app = app;
        }
    </script>
</body>
</html>
